<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚å…‰è¡Œè€…ï¼šç§¦æ¼¢é¢¨é›² (æœ€çµ‚å®Œç¾ç‰ˆ)</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ React å’Œ ReactDOM -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <!-- å¼•å…¥ Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <!-- å¼•å…¥åƒç´ å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* 1. å¾©å¤ä¸»é¡Œé…è‰²èˆ‡å­—é«” */
        body {
            font-family: 'DotGothic16', 'Noto Serif TC', monospace;
            background-color: #222034;
            color: #E8E8E8;
            overflow-x: hidden;
            background-image: repeating-linear-gradient(45deg, #3b3a5d 0, #3b3a5d 1px, #222034 1px, #222034 5px);
        }

        /* 2. éŠæˆ²ä¸»å®¹å™¨ - åƒç´ é‚Šæ¡†é¢¨æ ¼ */
        .game-container {
            border: 4px solid #5C5B7F;
            box-shadow: 8px 8px 0px 0px #1A192A;
            background-color: #4B4B6F;
        }
        
        /* 3. æŒ‰éˆ•æ¨£å¼ */
        .game-btn {
            background-color: #736E9B; 
            border: 3px solid #5C5B7F; 
            transition: all 0.1s;
            cursor: pointer;
            box-shadow: 4px 4px 0px 0px #1A192A;
            position: relative;
        }
        .game-btn:hover:not(:disabled) {
            background-color: #8C88B0;
            transform: translateY(-1px);
        }
        .game-btn:active:not(:disabled) {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px 0px #1A192A;
        }
        .game-btn.selected {
            background-color: #4a4238;
            border-color: #d4af37;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }

        /* 4. åœ–ç‰‡å®¹å™¨ */
        .scene-image-container {
            border: 4px solid #2b2b2b;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
            image-rendering: pixelated;
            background-color: #1a1a1a;
            min-height: 250px;
        }

        /* 5. æµ®å‹•æ•¸å€¼å‹•ç•« */
        .stat-float {
            position: absolute;
            animation: floatUp 2.5s ease-out forwards;
            font-weight: 900;
            pointer-events: none;
            z-index: 100;
            text-shadow: 2px 2px 0px #000;
            font-size: 1.5rem;
            color: #F8F4A6;
        }
        @keyframes floatUp {
            0% { opacity: 0; transform: translateY(10px); }
            15% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-60px); }
        }
        
        /* 6. éœ‡å‹•æ•ˆæœ */
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }

        /* æ»¾å‹•æ¢ç¾åŒ– */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #222034; }
        ::-webkit-scrollbar-thumb { background: #5C5B7F; border: 2px solid #222034; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- åœ–ç‰‡è³‡æºè·¯å¾‘ ---
        const SceneImages = {
            Classroom: "1.Classroom.webp",
            QinPalace: "2.QinPalace.webp",
            GreatWall: "3.GreatWall.webp",
            War: "4.War.webp",
            Farm: "5.Farm.webp",
            Desert: "6.Desert.webp",
            Study: "7.Study.webp",
            Treasury: "8.Treasury.webp",
            Fire: "9.Fire.webp",
            Prison: "10.Prison.webp",
            Map: "6.Desert.webp", 
            Crown: "2.QinPalace.webp", 
            Scroll: "7.Study.webp", 
            Hammer: "3.GreatWall.webp", 
            Scale: "8.Treasury.webp", 
            History: "7.Study.webp", 
            Award: "2.QinPalace.webp", 
            GameOver: "9.Fire.webp" 
        };

        // --- UI åœ–ç¤º ---
        const Icons = {
            Heart: () => <span>â¤</span>,
            Brain: () => <span>ğŸ§ </span>,
            Coin: () => <span>ğŸ’°</span>,
            Star: () => <span>ğŸ‘‘</span>,
            ArrowRight: () => <span>â–¶</span>,
            Refresh: () => <span>â†º</span>
        };

        // --- æ­·å²å•ç­”è³‡æ–™åº« (NPC éš¨æ©Ÿäº‹ä»¶) ---
        const historyQuizPool = [
            { npc: "ææ–¯", role: "ç§¦æœä¸ç›¸", question: "å¾æè­°å»¢åˆ†å°ï¼Œè¡Œéƒ¡ç¸£ã€‚ä½ å¯çŸ¥ç§¦æœå°‡å¤©ä¸‹åˆ†ç‚ºå¤šå°‘éƒ¡ï¼Ÿ", options: ["åäºŒéƒ¡", "ä¸‰åå…­éƒ¡", "å››åå…«éƒ¡", "å…«åä¸€éƒ¡"], answer: 1, correctMsg: "ç„¶ä¹Ÿï¼é›†æ¬Šä¸­å¤®ï¼Œæ–¹èƒ½é•·æ²»ä¹…å®‰ã€‚", wrongMsg: "è¬¬çŸ£ï¼é€£é€™ç­‰åœ‹ç­–éƒ½ä¸çŸ¥ï¼Ÿ", reward: { knowledge: 10, prestige: 5 }, penalty: { knowledge: -5 } },
            { npc: "èŠè»»", role: "ç‡•åœ‹åˆºå®¢", question: "é¢¨è•­è•­å…®æ˜“æ°´å¯’... ä¸‹ä¸€å¥ç‚ºä½•ï¼Ÿ", options: ["å£¯å£«ä¸€å»å…®ä¸å¾©é‚„", "å¤§é¢¨èµ·å…®é›²é£›æš", "åŠ›æ‹”å±±å…®æ°£è“‹ä¸–", "æ­¤æ¨ç¶¿ç¶¿ç„¡çµ•æœŸ"], answer: 0, correctMsg: "å¥½ï¼æ‡‚æˆ‘è€…ï¼Œå£¯å£«ä¹Ÿï¼", wrongMsg: "å“¼ï¼Œä¸æ‡‚é¢¨é›…ä¹‹è¼©ã€‚", reward: { health: 10, reputation: 5 }, penalty: { reputation: -5 } },
            { npc: "éŸ“ä¿¡", role: "å¤§å°‡è»", question: "å¾èƒŒæ°´ä¸€æˆ°æ“Šæ•—è¶™è»ï¼Œç½®ä¹‹æ­»åœ°è€Œå¾Œç”Ÿã€‚è«‹å•æ­¤æˆ°ç™¼ç”Ÿåœ¨ä½•è™•ï¼Ÿ", options: ["é‰…é¹¿", "äº•é™˜", "å“ä¸‹", "å®˜æ¸¡"], answer: 1, correctMsg: "å…µæ³•ä¹‹é“ï¼Œå­˜ä¹ä¸€å¿ƒã€‚", wrongMsg: "é€£æˆ°å ´æ–¹ä½éƒ½åˆ†ä¸æ¸…ï¼Œå¦‚ä½•å¸¶å…µï¼Ÿ", reward: { reputation: 15 }, penalty: { health: -10 } },
            { npc: "å¼µé¨«", role: "åšæœ›ä¾¯", question: "å¾å‡ºä½¿è¥¿åŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ç‚ºäº†è¯åˆå“ªå€‹åœ‹å®¶å¤¾æ“ŠåŒˆå¥´ï¼Ÿ", options: ["å¤§å®›", "çƒå­«", "å¤§æœˆæ°", "æ¨“è˜­"], answer: 2, correctMsg: "æ­£æ˜¯ï¼é›–æœªçµç›Ÿï¼Œå»é‘¿ç©ºè¥¿åŸŸã€‚", wrongMsg: "éä¹Ÿï¼Œçœ‹ä¾†ä½ å°è¥¿åŸŸå±€å‹¢ä¸€ç„¡æ‰€çŸ¥ã€‚", reward: { knowledge: 10, wealth: 10 }, penalty: { wealth: -5 } },
            { npc: "å¸é¦¬é·", role: "å¤ªå²ä»¤", question: "å¾å¯«ã€Šå²è¨˜ã€‹ï¼Œç«‹èª“è¦ã€Œç©¶å¤©äººä¹‹éš›ã€... ä¸‹å¥ç‚ºä½•ï¼Ÿ", options: ["æˆä¸€å®¶ä¹‹è¨€", "é€šå¤ä»Šä¹‹è®Š", "æµèŠ³ç™¾ä¸–", "ä»¥å²ç‚ºé¡"], answer: 1, correctMsg: "çŸ¥æˆ‘è€…è¬‚æˆ‘å¿ƒæ†‚ã€‚", wrongMsg: "å”‰ï¼Œè±å­ä¸è¶³èˆ‡è¬€ã€‚", reward: { knowledge: 15 }, penalty: { knowledge: -10 } },
            { npc: "è‘£ä»²èˆ’", role: "å„’å­¸å¤§å¸«", question: "å¾å‘æ­¦å¸å»ºè­°ã€Œç½·é»œç™¾å®¶ã€ï¼Œç¨å°Šå“ªä¸€å®¶ï¼Ÿ", options: ["é“å®¶", "æ³•å®¶", "å¢¨å®¶", "å„’å®¶"], answer: 3, correctMsg: "å–„å“‰ï¼Œæ•™åŒ–è¬æ°‘ï¼Œå”¯æœ‰å„’è¡“ã€‚", wrongMsg: "æœ½æœ¨ä¸å¯é›•ä¹Ÿã€‚", reward: { prestige: 10, knowledge: 5 }, penalty: { prestige: -5 } },
            { npc: "ç‹æ˜­å›", role: "å’Œè¦ªå…¬ä¸»", question: "ç‚ºäº†æ¼¢åŒˆå’Œå¹³ï¼Œæˆ‘å«çµ¦äº†å“ªä½å–®äºï¼Ÿ", options: ["å†’é “å–®äº", "å‘¼éŸ“é‚ªå–®äº", "ä¼Šç¨šæ–œå–®äº", "è»è‡£å–®äº"], answer: 1, correctMsg: "é¡˜é‚Šç–†æ°¸ç„¡æˆ°ç«ã€‚", wrongMsg: "é€£å¤«å›åå­—éƒ½è¨˜éŒ¯ï¼Œä»¤äººå¿ƒå¯’ã€‚", reward: { reputation: 15 }, penalty: { reputation: -10 } },
            { npc: "è”¡å€«", role: "å®¦å®˜/ç™¼æ˜å®¶", question: "æˆ‘æ”¹è‰¯äº†é€ ç´™è¡“ï¼Œä¸»è¦ä½¿ç”¨äº†ä»€éº¼åŸæ–™é™ä½æˆæœ¬ï¼Ÿ", options: ["çµ²ç¶¢", "æ¨¹çš®èˆ‡ç ´å¸ƒ", "ç¾Šçš®", "ç«¹ç°¡"], answer: 1, correctMsg: "ç‰©ç›¡å…¶ç”¨ï¼Œæ–¹èƒ½æƒ åŠå¤©ä¸‹ã€‚", wrongMsg: "è‹¥ç”¨é‚£æ˜‚è²´ä¹‹ç‰©ï¼Œç™¾å§“å¦‚ä½•ç”¨ç´™ï¼Ÿ", reward: { knowledge: 10, wealth: 5 }, penalty: { wealth: -5 } },
            { npc: "å¼µè§’", role: "å¤ªå¹³é“é¦–é ˜", question: "è’¼å¤©å·²æ­»ï¼Œé»ƒå¤©ç•¶ç«‹ï¼Œæ­²åœ¨...ï¼Ÿ", options: ["ç”²å­", "ä¹™ä¸‘", "ä¸™å¯…", "ä¸å¯"], answer: 0, correctMsg: "å¤©ä¸‹å¤§å‰ï¼åŠ å…¥æˆ‘å€‘å§ï¼", wrongMsg: "å¤©æ™‚æœªåˆ°ï¼Ÿä½ éæˆ‘é“ä¸­äººã€‚", reward: { health: 10, wealth: 10 }, penalty: { reputation: -10 } },
            { npc: "é …ç¾½", role: "è¥¿æ¥šéœ¸ç‹", question: "å¾èˆ‡åŠ‰é‚¦çˆ­å¥ªå¤©ä¸‹ï¼Œæœ€å¾Œæ±ºæˆ°æ–¼ä½•è™•ï¼Ÿ", options: ["é´»é–€", "å’¸é™½", "å“ä¸‹", "å½­åŸ"], answer: 2, correctMsg: "åŠ›æ‹”å±±å…®æ°£è“‹ä¸–ï¼Œæ™‚ä¸åˆ©å…®é¨…ä¸é€...", wrongMsg: "èƒ¡èªªå…«é“ï¼", reward: { health: 15 }, penalty: { health: -20 } }
        ];

        // --- æ­·å²åŠ‡æœ¬è³‡æ–™ ---
        const storyNodes = {
            "intro": {
                id: "intro",
                title: "åºç« ï¼šæ­·å²çš„å¬å–š",
                text: "è¥¿å…ƒ2024å¹´ã€‚æ­·å²èª²ä¸Šï¼Œè€å¸«è¬›è¿°è‘—ï¼šã€Œç§¦çš‡æ¼¢æ­¦ï¼Œç•¥è¼¸æ–‡é‡‡...ã€ä½ çš„æ€ç·’é£„å‘äº†å…©åƒå¹´å‰çš„æ™‚ç©ºæ¼©æ¸¦ã€‚",
                image: "Classroom",
                options: [
                    { text: "èªçœŸè½èª²", nextId: "qin_war", effect: { knowledge: 10 }, feedback: "çŸ¥è­˜å°±æ˜¯åŠ›é‡ã€‚", historyNote: "æ­·å²å­¸ç¿’èƒ½å¹«åŠ©æˆ‘å€‘ä»¥å¤é‘‘ä»Šï¼Œäº†è§£æœä»£èˆˆè¡°çš„è¦å¾‹ã€‚" },
                    { text: "ç¡è¦ºå„²å­˜é«”åŠ›", nextId: "qin_war", effect: { health: 10 }, feedback: "ç²¾ç¥é£½æ»¿åœ°ç©¿è¶Šäº†ã€‚", historyNote: "ç©¿è¶Šå°èªªä¸­ï¼Œä¸»è§’å¾€å¾€æ˜¯åœ¨ç¡å¤¢æˆ–æ„å¤–ä¸­å›åˆ°å¤ä»£ã€‚" },
                    { text: "å·çœ‹èª²å¤–æ›¸", nextId: "qin_war", effect: { wealth: 5, reputation: -5 }, feedback: "ä½ ç²å¾—äº†ä¸€äº›é›œå­¸çŸ¥è­˜ï¼Œä½†è¢«è€å¸«çªäº†ä¸€çœ¼ã€‚", historyNote: "å¤ä»£ä¹Ÿæœ‰ã€Œé–’æ›¸ã€ï¼Œå¦‚ã€Šå±±æµ·ç¶“ã€‹ã€‚" }
                ]
            },
            // 1. ç§¦æ»…å…­åœ‹ (è»äº‹)
            "qin_war": {
                id: "qin_war",
                title: "1. ç§¦æ»…å…­åœ‹ (BC 230-221)",
                text: "ä½ ç½®èº«æ–¼ç§¦è»å¤§å¸³ã€‚ç§¦ç‹å¬´æ”¿æ¬²ä¸€çµ±å¤©ä¸‹ï¼Œæ»…åœ‹ä¹‹æˆ°ä¸€è§¸å³ç™¼ã€‚ä½ ç¾åœ¨æ˜¯ä¸€åç§¦è»è¬€å£«ã€‚",
                image: "War",
                options: [
                    { text: "ç»è¨ˆã€Œé äº¤è¿‘æ”»ã€", nextId: "qin_system", effect: { knowledge: 15, reputation: 10, health: -5, wealth: 10 }, feedback: "ä½ çš„ç­–ç•¥åŠ é€Ÿäº†å…­åœ‹çš„æ»…äº¡ï¼", historyNote: "èŒƒé›å‘ç§¦æ˜­ç‹æå‡ºã€Œé äº¤è¿‘æ”»ã€ï¼Œå…ˆæ”»æ‰“é„°è¿‘çš„éŸ“é­ï¼Œæš«æ™‚è¯çµ¡é æ–¹çš„é½Šåœ‹ï¼Œé€™æ˜¯ç§¦çµ±ä¸€çš„é—œéµæˆ°ç•¥ã€‚" },
                    { text: "è¦ªä¸Šå‰ç·šæ®ºæ•µ", nextId: "qin_system", effect: { health: -10, wealth: 20, reputation: 5 }, feedback: "ä½ ç²å¾—äº†ç§¦åœ‹çš„è»åŠŸçˆµä½ã€‚", historyNote: "å•†é…è®Šæ³•å¾Œï¼Œç§¦åœ‹å¯¦è¡Œè»åŠŸçˆµåˆ¶ï¼Œå¹³æ°‘å¯ä»¥é€šéæ–¬é¦–æ•µè»ç²å¾—çˆµä½å’Œç”°å®…ï¼Œå¤§å¤§æ¿€å‹µäº†ç§¦è»æˆ°é¬¥åŠ›ã€‚" },
                    { text: "æ“”ä»»è»éœ€å®˜", nextId: "qin_system", effect: { wealth: 30, reputation: -5 }, feedback: "ä½ ç¢ºä¿äº†ç³§è‰å……è¶³ã€‚", historyNote: "ç§¦åœ‹æ“æœ‰ç™¼é”çš„è¾²æ¥­å’Œæ°´åˆ©ï¼ˆå¦‚é„­åœ‹æ¸ ã€éƒ½æ±Ÿå °ï¼‰ï¼Œç‚ºçµ±ä¸€æˆ°çˆ­æä¾›äº†å …å¯¦çš„å¾Œå‹¤ä¿éšœã€‚" }
                ]
            },
            // 2. éƒ¡ç¸£åˆ¶ vs åˆ†å°åˆ¶ (æ”¿æ²»)
            "qin_system": {
                id: "qin_system",
                title: "2. åˆ¶åº¦ä¹‹çˆ­ (BC 221)",
                text: "å¤©ä¸‹åˆå®šï¼Œæœå»·ä¸Šæ­£åœ¨çˆ­è«–å¯¦è¡Œã€Œéƒ¡ç¸£åˆ¶ã€é‚„æ˜¯ã€Œåˆ†å°åˆ¶ã€ã€‚ä¸ç›¸ç‹ç¶°ä¸»å¼µåˆ†å°ï¼Œå»·å°‰ææ–¯ä¸»å¼µéƒ¡ç¸£ã€‚",
                image: "QinPalace",
                options: [
                    { text: "æ”¯æŒææ–¯ï¼Œæ¨è¡Œéƒ¡ç¸£åˆ¶", nextId: "qin_standard", effect: { knowledge: 20, reputation: 10 }, feedback: "ç§¦å§‹çš‡æ¡ç´äº†å»ºè­°ï¼Œä¸­å¤®é›†æ¬Šç¢ºç«‹ï¼", historyNote: "ææ–¯åå°åˆ†å°å­å¼Ÿï¼Œèªç‚ºé€™æœƒå°è‡´åƒå‘¨æœä¸€æ¨£çš„è«¸ä¾¯æ··æˆ°ã€‚ç§¦å§‹çš‡æœ€çµ‚å°‡å¤©ä¸‹åˆ†ç‚ºä¸‰åå…­éƒ¡ï¼Œç”±ä¸­å¤®ç›´æ¥ç®¡è½„ã€‚" },
                    { text: "æ”¯æŒç‹ç¶°ï¼Œä¸»å¼µåˆ†å°", nextId: "qin_standard", effect: { reputation: -10 }, feedback: "ç§¦å§‹çš‡é§å›äº†ä½ çš„å»ºè­°ã€‚", historyNote: "ç‹ç¶°èªç‚ºç‡•ã€é½Šã€æ¥šç­‰åœ°åé ï¼Œä¸åˆ†å°ç‹ä¾¯é›£ä»¥é®å®ˆï¼Œä½†æ­¤è§€é»æœªè¢«æ¡ç´ã€‚" },
                    { text: "ä¿æŒæ²ˆé»˜", nextId: "qin_standard", effect: { health: 0 }, feedback: "ä½ é¸æ“‡äº†æ—è§€ã€‚", historyNote: "åœ¨ç§¦æœå»·è­°ä¸­ï¼Œå®˜å“¡å¯ä»¥è¡¨é”æ„è¦‹ï¼Œä½†æœ€çµ‚æ±ºç­–æ¬Šåœ¨çš‡å¸æ‰‹ä¸­ã€‚" }
                ]
            },
            // 3. çµ±ä¸€åº¦é‡è¡¡èˆ‡æ–‡å­— (ç¶“æ¿Ÿ/æ–‡åŒ–)
            "qin_standard": {
                id: "qin_standard",
                title: "3. è»ŠåŒè»Œï¼Œæ›¸åŒæ–‡ (BC 221)",
                text: "ç§¦å§‹çš‡ä¸‹ä»¤çµ±ä¸€åº¦é‡è¡¡ã€è²¨å¹£èˆ‡æ–‡å­—ã€‚å¸‚äº•ä¹‹é–“ï¼ŒèˆŠè²¨å¹£èˆ‡èˆŠæ–‡å­—æ­£åœ¨è¢«å»¢é™¤ã€‚",
                image: "Treasury",
                options: [
                    { text: "å­¸ç¿’ä¸¦æ¨å»£å°ç¯† (éœ€æ™ºåŠ›20)", nextId: "qin_construction", reqKnowledge: 20, effect: { knowledge: 15, reputation: 10, wealth: 10 }, feedback: "ä½ æˆç‚ºäº†æ–°æ–‡å­—çš„æ¨å»£è€…ã€‚", historyNote: "ç§¦çµ±ä¸€æ–‡å­—ç‚ºå°ç¯†ï¼ˆå¾Œæ¼”è®Šç‚ºéš¸æ›¸ï¼‰ï¼Œé€™å°ä¸­è¯æ–‡åŒ–çš„å‚³æ‰¿å’Œçµ±ä¸€æœ‰è‘—æ±ºå®šæ€§çš„å½±éŸ¿ã€‚" },
                    { text: "å…Œæ›ç§¦åŠå…©éŒ¢", nextId: "qin_construction", effect: { wealth: 20 }, feedback: "ä½ åˆ©ç”¨è²¨å¹£çµ±ä¸€çš„æ©Ÿæœƒè³ºäº†ä¸€ç­†ã€‚", historyNote: "ç§¦å§‹çš‡å»¢é™¤å…­åœ‹è²¨å¹£ï¼Œè¦å®šä»¥åœ“å½¢æ–¹å­”çš„ã€Œç§¦åŠå…©ã€ç‚ºé€šè¡Œè²¨å¹£ï¼Œé€™ç¨®å½¢åˆ¶æ²¿ç”¨äº†å…©åƒå¤šå¹´ã€‚" },
                    { text: "ç§è—å…­åœ‹èˆŠå¹£", nextId: "qin_construction", effect: { wealth: -10, reputation: -5 }, feedback: "èˆŠå¹£æˆäº†å»¢éŠ…çˆ›éµã€‚", historyNote: "çµ±ä¸€åº¦é‡è¡¡ï¼ˆåº¦ï¼šé•·åº¦ï¼Œé‡ï¼šå®¹ç©ï¼Œè¡¡ï¼šé‡é‡ï¼‰æ¶ˆé™¤äº†å„åœ°è²¿æ˜“éšœç¤™ï¼Œä½†ä¹Ÿè®“èˆŠæ¨™æº–å¤±æ•ˆã€‚" }
                ]
            },
            // 4. å¤§èˆˆåœŸæœ¨ (å‹å½¹)
            "qin_construction": {
                id: "qin_construction",
                title: "4. é•·åŸèˆ‡é˜¿æˆ¿å®® (BC 215)",
                text: "åŒ—æ–¹åŒˆå¥´å¨è„…ï¼Œå—æ–¹å¾è¨ç™¾è¶Šã€‚ç§¦å§‹çš‡åŒæ™‚ä¸‹ä»¤ä¿®ç¯‰é•·åŸã€é¦³é“èˆ‡é˜¿æˆ¿å®®ï¼Œå¾­å½¹ç¹é‡ã€‚",
                image: "GreatWall",
                options: [
                    { text: "åƒèˆ‡ä¿®ç¯‰é•·åŸ (éœ€é«”åŠ›30)", nextId: "qin_law", reqHealth: 30, effect: { health: -30, reputation: 20, wealth: 10 }, feedback: "å­Ÿå§œå¥³çš„å“­è²çŒ¶åœ¨è€³é‚Šï¼Œä½†ä½ å®ˆè­·äº†é‚Šç–†ã€‚", historyNote: "ç§¦é•·åŸè¥¿èµ·è‡¨æ´®ï¼Œæ±è‡³é¼æ±ã€‚é›–ç„¶é˜²ç¦¦äº†åŒˆå¥´ï¼Œä½†ç¹é‡çš„å¾­å½¹ä¹Ÿæ˜¯ç§¦æœæ»…äº¡çš„é‡è¦åŸå› ã€‚" },
                    { text: "æè³‡ä»¥æ­¤å…é™¤å‹å½¹ (éœ€è²¡å¯Œ40)", nextId: "qin_law", reqWealth: 40, effect: { wealth: -40, health: 10, reputation: -5 }, feedback: "æœ‰éŒ¢èƒ½ä½¿é¬¼æ¨ç£¨ï¼Œä½ èº²éäº†è‹¦å½¹ã€‚", historyNote: "ç§¦å¾‹å…è¨±é€šéç¹³ç´ç½°é‡‘ï¼ˆè²²ï¼‰æˆ–ç³§é£Ÿä¾†è´–ç½ªæˆ–å…é™¤éƒ¨åˆ†å‹å½¹ï¼Œé«”ç¾äº†æ³•å¾‹çš„éšç´šæ€§ã€‚" },
                    { text: "é€ƒé¿å‹å½¹è¢«æŠ“", nextId: "qin_law", effect: { health: -50, wealth: -20, reputation: -10 }, feedback: "ä½ è¢«æŠ“å»ä¿®é¦³é“ï¼Œå—ç›¡æŠ˜ç£¨ã€‚", historyNote: "ç§¦æœæ³•å¾‹åš´è‹›ï¼Œé€ƒé¿å¾­å½¹æœƒå—åˆ°åš´å²æ‡²ç½°ï¼Œç”šè‡³è¢«ç½°ç‚ºã€ŒåŸæ—¦èˆ‚ã€ï¼ˆç¯‰åŸæˆ–èˆ‚ç±³ï¼‰ã€‚" }
                ]
            },
            // 5. åš´åˆ‘å³»æ³• (æ³•å¾‹)
            "qin_law": {
                id: "qin_law",
                title: "5. é€£åæ³•ä¹‹å¨ (BC 213)",
                text: "ç§¦æ³•åš´è‹›ï¼Œå¯¦è¡Œé€£åã€‚é„°å±…çŠ¯æ³•ï¼Œä½ ä¹Ÿå¯èƒ½å—ç‰½é€£ã€‚è·¯ä¸Šå¶é‡ã€ææ–¯ã€‘ã€‚",
                image: "Prison",
                options: [
                    { text: "å‘ææ–¯è«‹æ•™æ³•å®¶æ€æƒ³", nextId: "qin_burn", effect: { knowledge: 20, reputation: -10 }, feedback: "ææ–¯ï¼šã€Œä»¥æ³•ç‚ºæ•™ï¼Œä»¥åç‚ºå¸«ã€‚ã€ä½ æ·±æ„Ÿéœ‡æ’¼ã€‚", historyNote: "éŸ“éå­çš„æ³•å®¶æ€æƒ³æ˜¯ç§¦æœçµ±æ²»çš„ç†è«–åŸºç¤ï¼Œå¼·èª¿å›ä¸»é›†æ¬Šã€åš´åˆ‘å³»æ³•å’Œä»¥æ³•æ²»åœ‹ã€‚" },
                    { text: "èˆ‰å ±é„°å±…å·ç›œ", nextId: "qin_burn", effect: { wealth: 30, reputation: -20 }, feedback: "ä½ ç²å¾—äº†è³é‡‘ï¼Œä½†é„°é‡Œè¦–ä½ ç‚ºæƒ¡äººã€‚", historyNote: "å•†é…è®Šæ³•è¨­ç«‹ã€Œä»€ä¼é€£åã€ï¼Œä¸€å®¶çŠ¯æ³•ï¼Œé„°é‡Œè‹¥ä¸å‘Šç™¼å‰‡åŒç½ªï¼Œå‘Šç™¼å‰‡æœ‰è³ã€‚" },
                    { text: "å¹«åŠ©é„°å±…éš±ç", nextId: "qin_burn", effect: { reputation: 20, health: -20 }, feedback: "ä½ ä¿ä½äº†é„°å±…ï¼Œä½†æ™‚åˆ»æ“”å¿ƒè¢«ç™¼ç¾ã€‚", historyNote: "å„’å®¶ä¸»å¼µã€Œçˆ¶ç‚ºå­éš±ï¼Œå­ç‚ºçˆ¶éš±ã€ï¼Œé€™èˆ‡æ³•å®¶çš„é€£åç²¾ç¥æ˜¯èƒŒé“è€Œé¦³çš„ã€‚" }
                ]
            },
            // 6. ç„šæ›¸å‘å„’
            "qin_burn": {
                id: "qin_burn",
                title: "6. ç„šæ›¸å‘å„’ (BC 213)",
                text: "åšå£«æ·³äºè¶Šå»ºè­°åˆ†å°ï¼Œè§¸æ€’å§‹çš‡ã€‚ææ–¯å»ºè­°ç„šæ›¸ã€‚å’¸é™½åŸå…§ç«å…‰æ²–å¤©ã€‚",
                image: "Fire",
                options: [
                    { text: "å†’æ­»è—æ›¸ (éœ€é«”åŠ›20)", nextId: "qin_end", reqHealth: 20, effect: { reputation: 30, health: -20, knowledge: 10 }, feedback: "ä½ ä¿ä½äº†æ–‡åŒ–çš„ç«ç¨®ã€‚", historyNote: "ç§¦å§‹çš‡ä¸‹ä»¤ç‡’æ¯€æ°‘é–“è—æ›¸ï¼Œåªä¿ç•™é†«è—¥ã€åœç­®ã€ç¨®æ¨¹ä¹‹æ›¸ï¼Œä¸¦æ´»åŸ‹äº†460å¤šåæ–¹å£«å’Œå„’ç”Ÿã€‚" },
                    { text: "äº¤å‡ºè—æ›¸", nextId: "qin_end", effect: { reputation: -10, knowledge: -5 }, feedback: "ä½ é¸æ“‡äº†é †å¾ã€‚", historyNote: "ç„šæ›¸å‘å„’å°å…ˆç§¦æ–‡åŒ–é€ æˆäº†æ¯€æ»…æ€§æ‰“æ“Šï¼Œè¨±å¤šå…¸ç±å¾æ­¤å¤±å‚³ã€‚" },
                    { text: "å†·çœ¼æ—è§€", nextId: "qin_end", effect: { health: 0 }, feedback: "ä½ é¸æ“‡æ˜å“²ä¿èº«ã€‚", historyNote: "é«˜å£“æ”¿ç­–é›–ç„¶ä¸€æ™‚çµ±ä¸€äº†æ€æƒ³ï¼Œä½†ä¹ŸåŸ‹ä¸‹äº†åæŠ—çš„ç¨®å­ã€‚" }
                ]
            },
            // 7. ç§¦æœæ»…äº¡
            "qin_end": {
                id: "qin_end",
                title: "7. å¸åœ‹å´©å¡Œ (BC 207)",
                text: "å§‹çš‡é§•å´©ï¼Œç§¦äºŒä¸–æš´æ”¿ã€‚é™³å‹å³å»£èµ·ç¾©ï¼Œå¤©ä¸‹å¤§äº‚ã€‚åŠ‰é‚¦æ”»å…¥å’¸é™½ã€‚",
                image: "War",
                options: [
                    { text: "æŠ•é åŠ‰é‚¦", nextId: "han_early", effect: { knowledge: 10, reputation: 10, wealth: 10 }, feedback: "ä½ é¸æ“‡äº†æ­£ç¢ºçš„éšŠä¼ï¼Œç´„æ³•ä¸‰ç« å¾—æ°‘å¿ƒã€‚", historyNote: "åŠ‰é‚¦é€²å…¥å’¸é™½å¾Œï¼Œå»¢é™¤ç§¦æœè‹›æ³•ï¼Œèˆ‡çˆ¶è€ç´„æ³•ä¸‰ç« ï¼šã€Œæ®ºäººè€…æ­»ï¼Œå‚·äººåŠç›œæŠµç½ªã€ï¼Œè´å¾—äº†æ°‘å¿ƒã€‚" },
                    { text: "æŠ•é é …ç¾½", nextId: "han_early", effect: { health: 10, wealth: 10, reputation: -5 }, feedback: "é …ç¾½ç«ç‡’é˜¿æˆ¿å®®ï¼Œä½ é›–æ¶å¾—è²¡å¯¶ï¼Œå»æ„Ÿå˜†æ–‡æ˜æ¯€æ»…ã€‚", historyNote: "é …ç¾½é›–ç„¶å‹‡çŒ›ï¼Œä½†å± åŸå’Œç«ç‡’é˜¿æˆ¿å®®çš„è¡Œç‚ºå¤±å»äº†æ°‘å¿ƒï¼Œæœ€çµ‚åœ¨æ¥šæ¼¢ç›¸çˆ­ä¸­æ•—çµ¦äº†åŠ‰é‚¦ã€‚" },
                    { text: "é€ƒå›é„‰é‡Œ", nextId: "han_early", effect: { health: 5, wealth: -5 }, feedback: "ä½ ä¿å…¨äº†æ€§å‘½ï¼Œç­‰å¾…æ–°æœå»ºç«‹ã€‚", historyNote: "ç§¦æœ«æˆ°äº‚å°è‡´äººå£éŠ³æ¸›ï¼Œè¨±å¤šç™¾å§“æµé›¢å¤±æ‰€ã€‚" }
                ]
            },
            // 8. æ¼¢åˆç„¡ç‚º
            "han_early": {
                id: "han_early",
                title: "8. é»ƒè€ä¹‹è¡“ (BC 202-180)",
                text: "æ¼¢æœåˆå»ºï¼Œæ°‘ç”Ÿå‡‹æ•ã€‚æœå»·æ¨è¡Œã€Œç„¡ç‚ºè€Œæ²»ã€ï¼Œä¼‘é¤Šç”Ÿæ¯ã€‚å¶é‡ã€æ›¹åƒã€‘ã€‚",
                image: "Farm",
                options: [
                    { text: "éŸ¿æ‡‰æ­¸è¾²ï¼Œé–‹å¢¾è’åœ°", nextId: "han_wenjing", effect: { health: 10, wealth: 20, reputation: 5 }, feedback: "è•­è¦æ›¹éš¨ï¼Œå¤©ä¸‹å¤ªå¹³ã€‚", historyNote: "æ¼¢åˆçµ±æ²»è€…å¸å–ç§¦äº¡æ•™è¨“ï¼Œæ¡ç”¨é“å®¶é»ƒè€ä¹‹è¡“ï¼Œè¼•å¾­è–„è³¦ï¼Œè®“ç™¾å§“ä¼‘é¤Šç”Ÿæ¯ã€‚" },
                    { text: "ç ”è®€é“å®¶ç¶“å…¸", nextId: "han_wenjing", effect: { knowledge: 20, reputation: 5 }, feedback: "ä½ é ˜æ‚Ÿäº†æ¸…éœç„¡ç‚ºçš„é“ç†ã€‚", historyNote: "åœ¨æ¼¢æ­¦å¸ç¨å°Šå„’è¡“ä¹‹å‰ï¼Œé»ƒè€æ€æƒ³æ˜¯æ¼¢åˆçš„ä¸»æµæ”¿æ²»æ€æƒ³ã€‚" },
                    { text: "å”åŠ©å®˜åºœ", nextId: "han_wenjing", effect: { prestige: 10 }, feedback: "ä½ åƒèˆ‡äº†åœ°æ–¹æ²»ç†ã€‚", historyNote: "æ¼¢åˆæ”¿æ²»æ¸…æ˜ï¼Œå®˜åå¤šå¥‰è¡Œç°¡æ”¿æ”¾æ¬Šã€‚" }
                ]
            },
            // 9. æ–‡æ™¯ä¹‹æ²»
            "han_wenjing": {
                id: "han_wenjing",
                title: "9. æ–‡æ™¯ä¹‹æ²» (BC 180-141)",
                text: "è¼•å¾­è–„è³¦ï¼Œç™¾å§“å¯Œåº¶ã€‚åœ‹åº«è£¡çš„éŒ¢ç¹©éƒ½çˆ›äº†ã€‚é€™æ˜¯ä¸­åœ‹æ­·å²ä¸Šç¬¬ä¸€å€‹ç››ä¸–ã€‚",
                image: "Treasury",
                options: [
                    { text: "å¤§åŠ›ç¶“å•†", nextId: "han_seven_states", effect: { wealth: 50, knowledge: 5 }, feedback: "ä½ æˆç‚ºäº†é•·å®‰åŸçš„å¯Œå•†ã€‚", historyNote: "æ–‡æ™¯æ™‚æœŸå•†æ¥­ç¹æ¦®ï¼Œå•†äººåœ°ä½æœ‰æ‰€æå‡ï¼Œä½†ä»å—ã€Œé‡è¾²æŠ‘å•†ã€æ”¿ç­–é™åˆ¶ã€‚" },
                    { text: "èˆˆè¾¦ç§å­¸", nextId: "han_seven_states", effect: { knowledge: 20, reputation: 20, wealth: -10 }, feedback: "ä½ æ¡ƒææ»¿å¤©ä¸‹ã€‚", historyNote: "æ¼¢æ–‡å¸å»¢é™¤äº†ç§¦æœçš„ã€ŒæŒ¾æ›¸å¾‹ã€ï¼Œæ°‘é–“è¬›å­¸ä¹‹é¢¨èˆˆèµ·ï¼Œæ–‡åŒ–é–‹å§‹å¾©ç”¦ã€‚" },
                    { text: "äº«å—ç››ä¸–", nextId: "han_seven_states", effect: { health: 20, wealth: -20 }, feedback: "ä½ åº¦éäº†ä¸€æ®µå¿«æ¨‚çš„æ™‚å…‰ã€‚", historyNote: "æ–‡æ™¯ä¹‹æ²»æ˜¯ä¸­åœ‹æ­·å²ä¸Šç¬¬ä¸€å€‹ç››ä¸–ï¼Œç™¾å§“ç”Ÿæ´»å¯Œè¶³ã€‚" }
                ]
            },
            // 10. ä¸ƒåœ‹ä¹‹äº‚
            "han_seven_states": {
                id: "han_seven_states",
                title: "10. ä¸ƒåœ‹ä¹‹äº‚ (BC 154)",
                text: "æ¼¢æ™¯å¸æ¡ç´æ™éŒ¯å»ºè­°ã€Œå‰Šè—©ã€ï¼Œå³ç‹åŠ‰æ¿è¯åˆå…­åœ‹èµ·å…µé€ åã€‚æˆ°ç«é€¼è¿‘ã€‚",
                image: "War",
                options: [
                    { text: "æŠ•èº«å‘¨äºå¤«è»å¹³å› (éœ€è²æœ›20)", nextId: "han_wu_ideology", reqReputation: 20, effect: { reputation: 30, health: -20, wealth: 20 }, feedback: "ä¸‰å€‹æœˆå¹³å®šä¸ƒåœ‹ä¹‹äº‚ï¼Œä½ ç«‹ä¸‹æˆ°åŠŸï¼", historyNote: "å‘¨äºå¤«åƒ…ç”¨ä¸‰å€‹æœˆå°±å¹³å®šäº†ä¸ƒåœ‹ä¹‹äº‚ï¼ŒåŠ å¼·äº†ä¸­å¤®é›†æ¬Šï¼Œç‚ºæ¼¢æ­¦å¸çš„å¤§ä¸€çµ±å¥ å®šäº†åŸºç¤ã€‚" },
                    { text: "æè³‡åŠ©è»", nextId: "han_wu_ideology", effect: { wealth: -30, reputation: 10 }, feedback: "ä½ çš„è²¡å¯Œå¹«åŠ©æœå»·ç©©å®šäº†å±€å‹¢ã€‚", historyNote: "æ¼¢æ™¯å¸ç‚ºäº†å¹³å›ï¼Œæ®ºäº†æ™éŒ¯è©¦åœ–è¬ç½ªï¼Œä½†å›è»ä¸¦æœªåœæ­¢ï¼Œæœ€çµ‚åªèƒ½æ­¦åŠ›å¹³å®šã€‚" },
                    { text: "èº²é¿æˆ°äº‚", nextId: "han_wu_ideology", effect: { health: 5, wealth: -10, reputation: -5 }, feedback: "ä½ å¹³å®‰åº¦éï¼Œä½†éŒ¯å¤±äº†å»ºåŠŸç«‹æ¥­çš„æ©Ÿæœƒã€‚", historyNote: "ä¸ƒåœ‹ä¹‹äº‚å¾Œï¼Œè«¸ä¾¯ç‹çš„æ¬ŠåŠ›è¢«å¤§å¹…å‰Šå¼±ï¼Œå†ä¹Ÿç„¡åŠ›å°æŠ—ä¸­å¤®ã€‚" }
                ]
            },
            // 11. ç¨å°Šå„’è¡“
            "han_wu_ideology": {
                id: "han_wu_ideology",
                title: "11. ç¨å°Šå„’è¡“ (BC 134)",
                text: "æ¼¢æ­¦å¸å³ä½ï¼Œæ¡ç´ã€è‘£ä»²èˆ’ã€‘å»ºè­°ï¼Œã€Œç½·é»œç™¾å®¶ï¼Œç¨å°Šå„’è¡“ã€ï¼Œå»ºç«‹å¤ªå­¸ã€‚",
                image: "Study",
                options: [
                    { text: "é€²å…¥å¤ªå­¸æ”»è®€äº”ç¶“ (éœ€æ™ºåŠ›30)", nextId: "han_wu_eco", reqKnowledge: 30, effect: { knowledge: 30, reputation: 10, health: -5 }, feedback: "ä½ æˆç‚ºäº†å¤©å­é–€ç”Ÿï¼Œå£«äººæ”¿åºœçš„ä¸€å“¡ã€‚", historyNote: "å¤ªå­¸æ˜¯æ¼¢ä»£æœ€é«˜å­¸åºœï¼Œå°ˆé–€æ•™æˆå„’å®¶äº”ç¶“ã€‚æˆç¸¾å„ªç§€è€…å¯ç›´æ¥åšå®˜ï¼Œé€™é–‹å•Ÿäº†å£«äººæ”¿åºœçš„å±€é¢ã€‚" },
                    { text: "å …æŒé»ƒè€æ€æƒ³", nextId: "han_wu_eco", effect: { reputation: -10, knowledge: 5 }, feedback: "ä½ çš„æ€æƒ³å·²ä¸åˆæ™‚å®œï¼Œä»•é€”å—é˜»ã€‚", historyNote: "å„’å®¶æ€æƒ³å¾æ­¤æˆç‚ºä¸­åœ‹å…©åƒå¤šå¹´çš„æ­£çµ±æ€æƒ³ï¼Œå¼·èª¿å›æ¬Šç¥æˆå’Œå¤§ä¸€çµ±ã€‚" },
                    { text: "å­¸ç¿’æ³•å®¶åˆ‘å", nextId: "han_wu_eco", effect: { reputation: 5, knowledge: 10, wealth: 10 }, feedback: "æ¼¢æœå¯¦ç‚ºã€Œå„’è¡¨æ³•è£¡ã€ã€‚", historyNote: "æ¼¢æ­¦å¸é›–ç„¶ç¨å°Šå„’è¡“ï¼Œä½†å¯¦éš›ä¸Šä¹Ÿé‡ç”¨é…·åï¼Œå¯¦è¡Œåš´åˆ‘å³»æ³•ã€‚" }
                ]
            },
            // 12. é¹½éµå®˜ç‡Ÿ
            "han_wu_eco": {
                id: "han_wu_eco",
                title: "12. é¹½éµå®˜ç‡Ÿ (BC 119)",
                text: "ç‚ºç±Œæªè»è²»ï¼Œæ¼¢æ­¦å¸ä»»ç”¨ã€æ¡‘å¼˜ç¾Šã€‘æ¨è¡Œé¹½éµå®˜ç‡Ÿã€å‡è¼¸å¹³æº–ã€‚å•†äººå€‘è­°è«–ç´›ç´›ã€‚",
                image: "Treasury",
                options: [
                    { text: "æ”¯æŒå®˜ç‡Ÿï¼Œæ‰“æ“Šå›¤ç©", nextId: "han_zhang_qian", effect: { reputation: 10, wealth: 20, knowledge: 10 }, feedback: "åœ‹åº«å……ç›ˆï¼Œç‚ºåŒ—ä¼æä¾›äº†åŸºç¤ã€‚", historyNote: "é¹½éµå®˜ç‡Ÿå°‡æœ€è³ºéŒ¢çš„é¹½éµè¡Œæ¥­æ”¶æ­¸åœ‹æœ‰ï¼Œæ¥µå¤§å¢åŠ äº†è²¡æ”¿æ”¶å…¥ï¼Œä½†ä¹Ÿæ‰“æ“Šäº†æ°‘é–“å·¥å•†æ¥­ã€‚" },
                    { text: "åå°å®˜ç‡Ÿï¼Œç‚ºæ°‘è«‹å‘½", nextId: "han_zhang_qian", effect: { reputation: 20, wealth: -10, knowledge: 10 }, feedback: "ä½ è´å¾—äº†æ°‘é–“å•†è³ˆçš„å°Šé‡ï¼Œä½†å¾—ç½ªäº†æœå»·ã€‚", historyNote: "æ¼¢æ˜­å¸æ™‚æ›¾å¬é–‹ã€Œé¹½éµæœƒè­°ã€ï¼Œè¾¯è«–å®˜ç‡Ÿæ”¿ç­–çš„å¾—å¤±ï¼Œé€™æ˜¯ä¸­åœ‹æ­·å²ä¸Šè‘—åçš„ç¶“æ¿Ÿæ”¿ç­–å¤§è¾¯è«–ã€‚" },
                    { text: "ç§ä¸‹å€’è³£é¹½éµ", nextId: "han_zhang_qian", effect: { wealth: 40, health: -10 }, feedback: "ä½ å¯Œå¯æ•µåœ‹ï¼Œä½†å†’è‘—æ¥µå¤§é¢¨éšªã€‚", historyNote: "é›–ç„¶æœ‰å®˜ç‡Ÿæ”¿ç­–ï¼Œä½†ç§é¹½è²©è³£å¾æœªåœæ­¢ï¼Œå¾€å¾€ä¼´éš¨è‘—é«˜é¡åˆ©æ½¤å’Œåš´å²æ‡²ç½°ã€‚" }
                ]
            },
            // 13. å¼µé¨«é€šè¥¿åŸŸ
            "han_zhang_qian": {
                id: "han_zhang_qian",
                title: "13. é‘¿ç©ºè¥¿åŸŸ (BC 138-126)",
                text: "ã€å¼µé¨«ã€‘å‡ºä½¿è¥¿åŸŸï¼Œå°‹æ‰¾å¤§æœˆæ°å¤¾æ“ŠåŒˆå¥´ã€‚é€™æ˜¯ä¸€æ¢å……æ»¿æœªçŸ¥èˆ‡å±éšªçš„é“è·¯ã€‚",
                image: "Map",
                options: [
                    { text: "éš¨å¼µé¨«å‡ºä½¿ (éœ€é«”åŠ›50)", nextId: "han_war", reqHealth: 50, effect: { health: -30, reputation: 40, wealth: 30, knowledge: 20 }, feedback: "ä½ å¸¶å›äº†è‘¡è„ã€è‹œè“¿ï¼Œé–‹é—¢äº†çµ²ç¶¢ä¹‹è·¯ï¼", historyNote: "å¼µé¨«å‡ºä½¿è¥¿åŸŸé›–ç„¶æ²’é”æˆè»äº‹ç›®çš„ï¼Œä½†æ‰“é€šäº†ä¸­è¥¿äº¤é€šï¼Œä¿ƒé€²äº†çµ²ç¶¢ä¹‹è·¯çš„ç¹æ¦®ã€‚" },
                    { text: "ç•™å®ˆé•·å®‰ç¹ªè£½åœ°åœ–", nextId: "han_war", effect: { knowledge: 20, wealth: 10, reputation: 5 }, feedback: "ä½ æ•´ç†äº†è¥¿åŸŸçš„åœ°ç†æƒ…å ±ã€‚", historyNote: "æ¼¢æœéš¨å¾Œåœ¨è¥¿åŸŸè¨­ç«‹äº†ã€Œè¥¿åŸŸéƒ½è­·åºœã€ï¼Œæ­£å¼å°‡è¥¿åŸŸç´å…¥ç‰ˆåœ–ã€‚" },
                    { text: "æŠ•è³‡çµ²ç¶¢è²¿æ˜“", nextId: "han_war", reqWealth: 30, effect: { wealth: 50 }, feedback: "ä½ æˆç‚ºäº†çµ²è·¯ä¸Šçš„å¤§å•†äººã€‚", historyNote: "ä¸­åœ‹çš„çµ²ç¶¢é€šéé€™æ¢é“è·¯å‚³åˆ°äº†ç¾…é¦¬ï¼Œè¥¿æ–¹å› æ­¤ç¨±ä¸­åœ‹ç‚ºã€çµ²åœ‹ã€(Seres)ã€‚" }
                ]
            },
            // 14. å¾è¨åŒˆå¥´
            "han_war": {
                id: "han_war",
                title: "14. æ¼ åŒ—æ±ºæˆ° (BC 119)",
                text: "è¡›é’ã€éœå»ç—…ç‡å¤§è»æ·±å…¥æ¼ åŒ—ã€‚é€™æ˜¯æ¼¢åŒˆæˆ°çˆ­æœ€é«˜æ½®ã€‚",
                image: "War",
                options: [
                    { text: "è¿½éš¨éœå»ç—…å°ç‹¼å±…èƒ¥ (éœ€é«”åŠ›60)", nextId: "han_su_wu", reqHealth: 60, effect: { reputation: 50, health: -40, wealth: 20, knowledge: 10 }, feedback: "åŒˆå¥´é éï¼Œæ¼ å—ç„¡ç‹åº­ï¼ä½ æˆç‚ºäº†ä¸€ä»£åå°‡ã€‚", historyNote: "éœå»ç—…å¹´å°‘æˆåï¼Œå°ç‹¼å±…èƒ¥å±±ï¼Œæ˜¯æ­¦å°‡çš„æœ€é«˜æ¦®è­½ã€‚æ¼¢è»å¤§å‹ï¼ŒåŒˆå¥´é éã€‚" },
                    { text: "æ“”ä»»å¾Œå‹¤é‹ç³§", nextId: "han_su_wu", effect: { health: -10, wealth: 10, reputation: 5 }, feedback: "å…µé¦¬æœªå‹•ï¼Œç³§è‰å…ˆè¡Œã€‚", historyNote: "æ¼¢æ­¦å¸é€£å¹´å¾æˆ°ï¼Œé›–ç„¶æ­¦åŠŸæ¥µç››ï¼Œä½†ä¹Ÿå°è‡´ã€Œæµ·å…§è™›è€—ï¼Œæˆ¶å£æ¸›åŠã€ã€‚" },
                    { text: "ç•æˆ°é€ƒè·‘", nextId: "han_su_wu", effect: { reputation: -30, health: 5 }, feedback: "ä½ ä¿ä½äº†æ€§å‘½ï¼Œä½†æˆäº†é€ƒå…µã€‚", historyNote: "æ¼¢å¾‹å°é€ƒå…µæ‡²ç½°æ¥µåš´ï¼Œå¾€å¾€æœƒç´¯åŠå®¶äººã€‚" }
                ]
            },
            // 15. è˜‡æ­¦ç‰§ç¾Š
            "han_su_wu": {
                id: "han_su_wu",
                title: "15. è˜‡æ­¦ç‰§ç¾Š (BC 100)",
                text: "è˜‡æ­¦å‡ºä½¿åŒˆå¥´è¢«æ‰£ç•™ï¼Œæµæ”¾åŒ—æµ·ç‰§ç¾Šåä¹å¹´ï¼ŒæŒç¯€ä¸å±ˆã€‚",
                image: "Desert",
                options: [
                    { text: "è¨­æ³•ç‚ºè˜‡æ­¦é€å»é£Ÿç‰© (éœ€è²¡å¯Œ30)", nextId: "han_sima", reqWealth: 30, effect: { wealth: -20, reputation: 30 }, feedback: "ä½ çš„ç¾©èˆ‰è®“è˜‡æ­¦å¾—ä»¥å …æŒä¸‹å»ã€‚", historyNote: "è˜‡æ­¦åœ¨åŒ—æµ·ï¼ˆä»Šè²åŠ çˆ¾æ¹–ï¼‰æŒ–é‡é¼ æ´ã€åƒè‰æ ¹ï¼Œå …æŒæ¼¢ç¯€ä¸é™ï¼Œæˆç‚ºå¿ å›æ„›åœ‹çš„å…¸ç¯„ã€‚" },
                    { text: "å‹¸èªªåŒˆå¥´å–®äºæ”¾äºº (éœ€æ™ºåŠ›50)", nextId: "han_sima", reqKnowledge: 50, effect: { knowledge: 10, reputation: 20 }, feedback: "é›–ç„¶å–®äºæœªå®Œå…¨ç­”æ‡‰ï¼Œä½†æ”¹å–„äº†æ¼¢ä½¿å¾…é‡ã€‚", historyNote: "ç›´åˆ°æ¼¢æ˜­å¸æ™‚æœŸï¼Œæ¼¢åŒˆå’Œè¦ªï¼Œè˜‡æ­¦æ‰å¾—ä»¥ç²é‡‹å›åœ‹ã€‚" },
                    { text: "æ„Ÿå˜†å¿ ç¾©ï¼Œè‡ªè¡Œé›¢å»", nextId: "han_sima", effect: { knowledge: 5 }, feedback: "ä½ è¦‹è­‰äº†ä½•ç‚ºæ°£ç¯€ã€‚", historyNote: "æé™µå‹¸é™è˜‡æ­¦å¤±æ•—ï¼Œç¾æ„§é›¢å»ã€‚å…©äººçš„é¸æ“‡æˆç‚ºåƒå¤è©±é¡Œã€‚" }
                ]
            },
            // 16. å¸é¦¬é·å¯«å²è¨˜
            "han_sima": {
                id: "han_sima",
                title: "16. å²å®¶çµ•å”± (BC 99)",
                text: "ã€å¸é¦¬é·ã€‘å› æé™µæ¡ˆä¸‹ç„ï¼Œé¢è‡¨ç”Ÿæ­»æŠ‰æ“‡ã€‚",
                image: "Prison",
                options: [
                    { text: "å‚¾å®¶è•©ç”¢ç‚ºå¸é¦¬é·è´–ç½ª (éœ€è²¡å¯Œ80)", nextId: "han_zhaojun", reqWealth: 80, effect: { wealth: -80, reputation: 30, knowledge: 10 }, feedback: "ä½ çš„ç¾©èˆ‰éœ‡é©šæœé‡ï¼Œé›–æœªæ•‘å‡ºï¼Œä½†æƒ…ç¾©åƒå¤ã€‚", historyNote: "æ¼¢å¾‹è¦å®šå¯ä»¥ç”¨éŒ¢è´–æ­»ç½ªï¼Œä½†å¸é¦¬é·å®¶è²§ä¸”ç„¡äººç›¸åŠ©ï¼Œæœ€çµ‚é¸æ“‡æ¥å—å®®åˆ‘ä»¥å®Œæˆå²è¨˜ã€‚" },
                    { text: "ç„ä¸­æ¢æœ›ï¼Œé¼“å‹µè‘—æ›¸", nextId: "han_zhaojun", effect: { knowledge: 30, reputation: 10 }, feedback: "ã€Šå²è¨˜ã€‹å¾—ä»¥å®Œæˆï¼Œä½ è¦‹è­‰äº†æ­·å²çš„èª•ç”Ÿã€‚", historyNote: "å¸é¦¬é·ç™¼æ†¤è‘—æ›¸ï¼Œå¯«æˆã€Šå²è¨˜ã€‹ï¼Œè¢«é­¯è¿…è­½ç‚ºã€Œå²å®¶ä¹‹çµ•å”±ï¼Œç„¡éŸ»ä¹‹é›¢é¨·ã€ã€‚" },
                    { text: "é¿ä¹‹å”¯æä¸åŠ", nextId: "han_zhaojun", effect: { reputation: -10 }, feedback: "ä½ é¸æ“‡äº†å†·æ¼ ã€‚", historyNote: "åœ¨å°ˆåˆ¶çš‡æ¬Šä¸‹ï¼Œå¤§è‡£å€‘å¾€å¾€æ˜å“²ä¿èº«ï¼Œä¸æ•¢ç‚ºåŒåƒšèªªè©±ã€‚" }
                ]
            },
            // 17. æ˜­å›å‡ºå¡
            "han_zhaojun": {
                id: "han_zhaojun",
                title: "17. æ˜­å›å‡ºå¡ (BC 33)",
                text: "æ¼¢å…ƒå¸æ™‚æœŸï¼Œå‘¼éŸ“é‚ªå–®äºä¾†æœæ±‚è¦ªã€‚å®®å¥³ç‹æ˜­å›ä¸»å‹•è«‹çº“å‡ºå¡å’Œè¦ªã€‚",
                image: "Desert",
                options: [
                    { text: "è­·é€æ˜­å›å‡ºå¡ (éœ€é«”åŠ›30)", nextId: "wang_mang", reqHealth: 30, effect: { health: -20, reputation: 20, wealth: 20, knowledge: 10 }, feedback: "é‚Šç–†ç¶­æŒäº†åŠå€‹ä¸–ç´€çš„å’Œå¹³ï¼Œä½ ä¸€è·¯è­·é€æœ‰åŠŸã€‚", historyNote: "æ˜­å›å‡ºå¡ç‚ºæ¼¢åŒˆå¸¶ä¾†äº†60å¹´çš„å’Œå¹³ï¼Œæ˜¯æ°‘æ—èåˆçš„ä½³è©±ã€‚" },
                    { text: "æ­ç™¼ç•«å¸«æ¯›å»¶å£½", nextId: "wang_mang", effect: { reputation: 15, wealth: 10 }, feedback: "æ¯›å»¶å£½ä¼æ³•ï¼Œä½†æ˜­å›å·²é å»ã€‚", historyNote: "å‚³èªªç•«å¸«ç´¢è³„ä¸æˆæ•…æ„ç•«é†œæ˜­å›ã€‚æ¼¢å…ƒå¸è¦‹æ˜­å›ç¾è²Œå¾Œæ‚”ä¸å·²ï¼Œæ®ºäº†æ¯›å»¶å£½ã€‚" },
                    { text: "æ„Ÿå˜†ç´…é¡è–„å‘½", nextId: "wang_mang", effect: { knowledge: 5 }, feedback: "ä½ å¯«ä¸‹äº†ä¸€é¦–é€åˆ¥è©©ã€‚", historyNote: "æ˜­å›å‡ºå¡çš„æ•…äº‹æˆç‚ºå¾Œä¸–ç„¡æ•¸è©©è©æˆ²æ›²çš„é¡Œæã€‚" }
                ]
            },
            // 18. ç‹è½æ”¹åˆ¶
            "wang_mang": {
                id: "wang_mang",
                title: "18. ç‹è½æ–°æœ (AD 9)",
                text: "ç‹è½ç¯¡æ¼¢ï¼Œå»ºç«‹æ–°æœï¼Œæ¨è¡Œã€Œç‹ç”°åˆ¶ã€èˆ‡å¹£åˆ¶æ”¹é©ï¼Œå¤©ä¸‹å¤§äº‚ã€‚",
                image: "Treasury",
                options: [
                    { text: "é è¦‹å¹£åˆ¶å´©æ½°ï¼Œå›¤ç©é»ƒé‡‘ (éœ€æ™ºåŠ›40)", nextId: "han_guangwu", reqKnowledge: 40, effect: { knowledge: 20, wealth: 30 }, feedback: "ä½ çš„ç¶“æ¿Ÿé ­è…¦è®“ä½ åœ¨äº‚ä¸–ä¸­ä¿å…¨äº†è³‡ç”¢ã€‚", historyNote: "ç‹è½å››æ¬¡æ”¹é©å¹£åˆ¶ï¼Œè²¨å¹£ç¨®é¡ç¹é›œï¼Œå°è‡´ç¶“æ¿Ÿå´©æ½°ï¼Œç™¾å§“ç ´ç”¢ã€‚" },
                    { text: "åŠ å…¥ç¶ æ—èµ¤çœ‰èµ·ç¾©", nextId: "han_guangwu", effect: { health: -20, reputation: 20, wealth: 10 }, feedback: "æ–°æœæ»…äº¡ï¼Œå…‰æ­¦ä¸­èˆˆã€‚", historyNote: "ç‹è½æ”¹åˆ¶é›–ç„¶ç«‹æ„è‰¯å¥½ï¼ˆå¦‚å»¢é™¤å¥´éš¸ï¼‰ï¼Œä½†è„«é›¢ç¾å¯¦ï¼Œæœ€çµ‚è¢«ç¶ æ—ã€èµ¤çœ‰èµ·ç¾©è»æ¨ç¿»ã€‚" },
                    { text: "ç›¡å¿ ç‹è½ï¼Œæ”¯æŒæ”¹é©", nextId: "han_guangwu", effect: { wealth: -20, reputation: -20 }, feedback: "ä½ éš¨æ–°æœä¸€åŒè¦†æ»…ã€‚", historyNote: "ç‹è½è¢«æ­·å²å­¸å®¶ç¨±ç‚ºã€ç©¿è¶Šè€…ã€ï¼Œä»–çš„å¾ˆå¤šæ”¿ç­–å¤ªéè¶…å‰æˆ–å¾©å¤ï¼Œä¸åˆæ™‚å®œã€‚" }
                ]
            },
            // 19. å…‰æ­¦ä¸­èˆˆ
            "han_guangwu": {
                id: "han_guangwu",
                title: "19. å…‰æ­¦ä¸­èˆˆ (AD 25)",
                text: "åŠ‰ç§€å»ºç«‹æ±æ¼¢ï¼Œå®šéƒ½æ´›é™½ã€‚å¯¦è¡Œã€ŒæŸ”é“ã€æ²»åœ‹ï¼Œé‡‹æ”¾å¥´å©¢ï¼Œé€€åŠŸè‡£ã€‚",
                image: "QinPalace",
                options: [
                    { text: "æŠ•å¥”åŠ‰ç§€ï¼Œæˆç‚ºåŠŸè‡£ (éœ€è²æœ›30)", nextId: "han_ban_chao", reqReputation: 30, effect: { reputation: 30, wealth: 40, health: -10, knowledge: 10 }, feedback: "æŸ”é“æ²»åœ‹ï¼Œå¤©ä¸‹é‡æ­¸ä¸€çµ±ã€‚", historyNote: "å…‰æ­¦å¸åŠ‰ç§€æ¨è¡Œã€ŒæŸ”é“ã€æ²»åœ‹ï¼Œé‡‹æ”¾å¥´å©¢ï¼Œé€€åŠŸè‡£é€²æ–‡åï¼Œé–‹å‰µäº†ã€Œå…‰æ­¦ä¸­èˆˆã€ã€‚" },
                    { text: "è§£ç”²æ­¸ç”°ï¼Œå®‰å¿ƒç¨®åœ°", nextId: "han_ban_chao", effect: { health: 20, wealth: 10 }, feedback: "äº«å—ä¹…é•çš„å’Œå¹³ã€‚", historyNote: "æ±æ¼¢åˆæœŸç¤¾æœƒç¶“æ¿Ÿè¿…é€Ÿæ¢å¾©ï¼Œäººå£å¤§å¹…å¢é•·ã€‚" },
                    { text: "å‰²æ“šä¸€æ–¹ï¼Œå°æŠ—æ¼¢è»", nextId: "han_ban_chao", effect: { health: -30, reputation: -20 }, feedback: "ä½ è¢«æ¼¢è»æ“Šæ•—ï¼Œæµäº¡æµ·å¤–ã€‚", historyNote: "åŠ‰ç§€ç”¨äº†åå¹¾å¹´æ™‚é–“æ‰å¾¹åº•æ¶ˆæ»…å„åœ°çš„å‰²æ“šå‹¢åŠ›ã€‚" }
                ]
            },
            // 20. æŠ•ç­†å¾æˆ
            "han_ban_chao": {
                id: "han_ban_chao",
                title: "20. æŠ•ç­†å¾æˆ (AD 73)",
                text: "ç­è¶…ä¸é¡˜åªæ˜¯æŠ„å¯«æ–‡æ›¸ï¼Œæ±ºå®šæ”¾ä¸‹æ¯›ç­†ï¼Œå‡ºä½¿è¥¿åŸŸï¼Œé‡æŒ¯æ¼¢æœè²å¨ã€‚",
                image: "Desert",
                options: [
                    { text: "æ•ˆæ³•ç­è¶…ï¼Œå‡ºä½¿è¥¿åŸŸ", nextId: "east_han_politics", effect: { knowledge: 10, reputation: 20, health: -10, wealth: 10 }, feedback: "ä¸å…¥è™ç©´ï¼Œç„‰å¾—è™å­ï¼", historyNote: "ç­è¶…ç¶“ç‡Ÿè¥¿åŸŸä¸‰åå¹´ï¼Œåƒ…é å°‘é‡å…µåŠ›å°±æ”¶æœäº†è¥¿åŸŸäº”åå¤šåœ‹ï¼Œé‡æ–°æ‰“é€šçµ²ç¶¢ä¹‹è·¯ã€‚" },
                    { text: "ç¹¼çºŒåšæ–‡æ›¸å·¥ä½œ", nextId: "east_han_politics", effect: { knowledge: 5, wealth: 10, health: 5 }, feedback: "å¹³ç©©ä¸€ç”Ÿï¼Œä½†ç•¥é¡¯å¹³åº¸ã€‚", historyNote: "æ±æ¼¢ä¸­æœŸä»¥å¾Œï¼Œæ–‡å®˜é›†åœ˜é€æ¼¸å½¢æˆï¼Œèˆ‡å¾Œä¾†çš„å¤–æˆšã€å®¦å®˜å½¢æˆæ”¿æ²»è§’åŠ›ã€‚" },
                    { text: "ç¶“å•†è‡´å¯Œ", nextId: "east_han_politics", effect: { wealth: 20, reputation: 0 }, feedback: "ä½ æˆç‚ºäº†çµ²è·¯å¯Œå•†ã€‚", historyNote: "æ±æ¼¢æ™‚æœŸï¼Œæ´›é™½å•†æ¥­ç¹æ¦®ï¼Œçµ²ç¶¢ä¹‹è·¯è²¿æ˜“èˆˆç››ã€‚" }
                ]
            },
            // 21. å¤–æˆšèˆ‡å®¦å®˜
            "east_han_politics": {
                id: "east_han_politics",
                title: "21. å¤–æˆšèˆ‡å®¦å®˜ (AD 100+)",
                text: "æ±æ¼¢ä¸­æœŸä»¥å¾Œï¼Œçš‡å¸å¹´å¹¼ï¼Œå¤ªåè‡¨æœï¼Œå¤–æˆšå°ˆæ¬Šã€‚çš‡å¸é•·å¤§å¾Œå¾€å¾€ä¾é å®¦å®˜å¥ªæ¬Šã€‚",
                image: "Crown",
                options: [
                    { text: "ä¾é™„å¤–æˆšç«‡æ°", nextId: "han_tech", effect: { wealth: 30, reputation: -10, health: -10 }, feedback: "æ¬Šå‚¾ä¸€æ™‚ï¼Œä½†å¥½æ™¯ä¸é•·ã€‚", historyNote: "å¤–æˆšç«‡æ†²é›–ç„¶æ“Šæ•—åŒˆå¥´å‹’çŸ³ç‡•ç„¶ï¼Œä½†å› å°ˆæ¬Šæœ€çµ‚è¢«æ¼¢å’Œå¸è¯åˆå®¦å®˜èª…æ®ºã€‚" },
                    { text: "çµäº¤æ¸…æµåå£« (éœ€æ™ºåŠ›50)", nextId: "han_tech", reqKnowledge: 50, effect: { reputation: 20, knowledge: 10 }, feedback: "ä¿æŒæ°£ç¯€ï¼Œå—äººå°Šæ•¬ã€‚", historyNote: "å£«å¤§å¤«éšå±¤ï¼ˆæ¸…æµï¼‰æŠ¨æ“Šæ™‚æ”¿ï¼Œåå°å®¦å®˜å°ˆæ¬Šï¼Œå°è‡´äº†å¾Œä¾†çš„é»¨éŒ®ä¹‹ç¦ã€‚" },
                    { text: "é é›¢æœå ‚ï¼Œæ˜å“²ä¿èº«", nextId: "han_tech", effect: { health: 10 }, feedback: "çœ¼ä¸è¦‹ç‚ºæ·¨ã€‚", historyNote: "æ±æ¼¢æœ«å¹´æ”¿æ²»é»‘æš—ï¼Œè¨±å¤šçŸ¥è­˜åˆ†å­é¸æ“‡éš±å±…ä¸ä»•ã€‚" }
                ]
            },
            // 22. æ±æ¼¢ç§‘æŠ€
            "han_tech": {
                id: "han_tech",
                title: "22. ç§‘æŠ€å·”å³° (AD 105)",
                text: "æ±æ¼¢æ™‚æœŸï¼Œè”¡å€«æ”¹é€²é€ ç´™è¡“ï¼Œå¼µè¡¡ç™¼æ˜åœ°å‹•å„€ã€‚",
                image: "Study",
                options: [
                    { text: "æŠ•è³‡é€ ç´™è¡“æ¨å»£ (éœ€è²¡å¯Œ40)", nextId: "han_disaster", reqWealth: 40, effect: { knowledge: 30, reputation: 20, wealth: -20 }, feedback: "æ–‡æ˜å› ç´™å¼µè€Œå‚³æ‰¿ï¼Œä½ åŠŸä¸å¯æ²’ã€‚", historyNote: "è”¡å€«ç”¨æ¨¹çš®ã€éº»é ­ç­‰å»‰åƒ¹åŸæ–™é€ ç´™ï¼ˆè”¡ä¾¯ç´™ï¼‰ï¼Œä½¿ç´™å¼µå–ä»£ç°¡ç‰˜æˆç‚ºä¸»è¦æ›¸å¯«ææ–™ã€‚" },
                    { text: "èˆ‡å¼µè¡¡è§€æ¸¬æ˜Ÿè±¡", nextId: "han_disaster", effect: { knowledge: 40, health: 10, reputation: 10 }, feedback: "ä½ æ´æ‚‰äº†å®‡å®™çš„å¥§ç§˜ã€‚", historyNote: "å¼µè¡¡ä¸åƒ…ç™¼æ˜äº†å€™é¢¨åœ°å‹•å„€ï¼Œé‚„æå‡ºäº†ã€æ¸¾å¤©èªªã€ï¼Œæ˜¯æ±æ¼¢æœ€å‰å¤§çš„ç§‘å­¸å®¶ã€‚" },
                    { text: "ç ”ç©¶é†«å­¸ (è¯ä½—/å¼µä»²æ™¯)", nextId: "han_disaster", effect: { health: 20, reputation: 10 }, feedback: "æ‡¸å£ºæ¿Ÿä¸–ï¼Œæ•‘äººç„¡æ•¸ã€‚", historyNote: "æ±æ¼¢æœ«å¹´å‡ºç¾äº†ã€é†«è–ã€å¼µä»²æ™¯ï¼ˆå‚·å¯’é›œç—…è«–ï¼‰å’Œç¥é†«è¯ä½—ï¼ˆéº»æ²¸æ•£ï¼‰ã€‚" }
                ]
            },
            // 23. é»¨éŒ®ä¹‹ç¦
            "han_disaster": {
                id: "han_disaster",
                title: "23. é»¨éŒ®ä¹‹ç¦ (AD 166)",
                text: "å®¦å®˜å°ˆæ¬Šï¼Œæ‰“å£“å£«å¤§å¤«ã€‚æœå»·ä¸‹ä»¤é€®æ•ã€Œé»¨äººã€ï¼Œæ”¿æ²»æ¥µåº¦é»‘æš—ã€‚",
                image: "Prison",
                options: [
                    { text: "ç‡Ÿæ•‘è¢«è¿«å®³çš„åå£« (éœ€é«”åŠ›30)", nextId: "yellow_turban", reqHealth: 30, effect: { reputation: 40, health: -30, wealth: -20, knowledge: 10 }, feedback: "æ¥µåº¦å±éšªï¼Œä½†ä½ è´å¾—äº†å¤©ä¸‹çš„æ•¬é‡ã€‚", historyNote: "èŒƒæ»‚ç­‰åå£«å¯§æ­»ä¸å±ˆï¼Œå±•ç¾äº†å£«å¤§å¤«çš„æ°£ç¯€ã€‚é»¨éŒ®ä¹‹ç¦å‹•æ–äº†æ±æ¼¢çš„çµ±æ²»æ ¹åŸºã€‚" },
                    { text: "ä¾é™„å®¦å®˜ä»¥æ±‚è‡ªä¿", nextId: "yellow_turban", effect: { wealth: 50, reputation: -50 }, feedback: "ä½ ä¿å…¨äº†æ€§å‘½ï¼Œå»å¤±å»äº†åè²ã€‚", historyNote: "ç•¶æ™‚æ°‘é–“æœ‰è«ºèªï¼šã€èˆ‰ç§€æ‰ï¼Œä¸çŸ¥æ›¸ï¼›èˆ‰å­å»‰ï¼Œçˆ¶åˆ¥å±…ã€ï¼Œè«·åˆºé¸å®˜åˆ¶åº¦çš„è…æ•—ã€‚" },
                    { text: "éš±å±…å±±æ—", nextId: "yellow_turban", effect: { knowledge: 10, health: 10, wealth: -10 }, feedback: "é¿ä¸–ä¸å‡ºï¼Œç­‰å¾…æ™‚æ©Ÿã€‚", historyNote: "äº‚ä¸–ä¹‹ä¸­ï¼Œè¨±å¤šäººé¸æ“‡æ˜å“²ä¿èº«ã€‚" }
                ]
            },
            // 24. é»ƒå·¾èµ·ç¾©
            "yellow_turban": {
                id: "yellow_turban",
                title: "24. é»ƒå·¾èµ·ç¾© (AD 184)",
                text: "ã€Œè’¼å¤©å·²æ­»ï¼Œé»ƒå¤©ç•¶ç«‹ï¼ã€å¼µè§’ç‡é ˜è¾²æ°‘èµ·ç¾©ï¼Œå¤©ä¸‹å¤§äº‚ã€‚",
                image: "War",
                options: [
                    { text: "çµ„ç¹”ç¾©å…µï¼Œä¿è¡›å®¶åœ’ (éœ€è²æœ›50)", nextId: "dong_zhuo", reqReputation: 50, effect: { reputation: 30, health: -20, wealth: 10, knowledge: 10 }, feedback: "ä½ æˆç‚ºäº†ä¸€æ–¹è±ªå¼·ã€‚", historyNote: "ç‚ºäº†é®å£“é»ƒå·¾è»ï¼Œæœå»·ä¸‹æ”¾è»æ¬Šçµ¦åœ°æ–¹å·ç‰§ï¼Œå°è‡´äº†å¾Œä¾†çš„è»é–¥å‰²æ“šã€‚" },
                    { text: "åŠ å…¥é»ƒå·¾è»", nextId: "dong_zhuo", effect: { health: -10, wealth: 20, reputation: -10 }, feedback: "æ¶ç³§æ¶éŒ¢ï¼Œä½†æœ€çµ‚è¢«é®å£“ã€‚", historyNote: "é»ƒå·¾èµ·ç¾©æ˜¯ä¸­åœ‹æ­·å²ä¸Šè¦æ¨¡æœ€å¤§çš„ä»¥å®—æ•™å½¢å¼çµ„ç¹”çš„è¾²æ°‘èµ·ç¾©ï¼Œæ²‰é‡æ‰“æ“Šäº†æ±æ¼¢çµ±æ²»ã€‚" },
                    { text: "æ”œå®¶å¸¶çœ·é€ƒé›£", nextId: "dong_zhuo", effect: { health: -20, wealth: -20 }, feedback: "æµé›¢å¤±æ‰€ï¼Œè‹¦ä¸å ªè¨€ã€‚", historyNote: "æˆ°äº‚å°è‡´äººå£éŠ³æ¸›ï¼Œã€ç™½éª¨éœ²æ–¼é‡ï¼Œåƒé‡Œç„¡é›é³´ã€ã€‚" }
                ]
            },
            // 25. è‘£å“äº‚æ”¿
            "dong_zhuo": {
                id: "dong_zhuo",
                title: "25. è‘£å“äº‚æ”¿ (AD 189)",
                text: "è‘£å“é€²äº¬ï¼Œå»¢å°‘å¸ï¼Œç«‹ç»å¸ï¼Œç«ç‡’æ´›é™½ã€‚é€™æ˜¯æ­·å²æ—…ç¨‹çš„çµ‚é»ã€‚",
                image: "Fire",
                options: [
                    { text: "åƒåŠ åå…«è·¯è«¸ä¾¯è¨è‘£", nextId: "ending_calc", reqHealth: 50, effect: { reputation: 40, health: -30 }, feedback: "é›–ç„¶è¯è»å¤±æ•—ï¼Œä½†ä½ å±•ç¾äº†å¿ ç¾©ã€‚", historyNote: "è¨è‘£è¯ç›Ÿå› å„æ‡·é¬¼èƒè€Œè§£æ•£ï¼Œé–‹å•Ÿäº†ä¸‰åœ‹è»é–¥æ··æˆ°ã€‚" },
                    { text: "ä¿è­·ç™¾å§“æ’¤é›¢æ´›é™½", nextId: "ending_calc", effect: { reputation: 30, wealth: -10 }, feedback: "ä½ æ•‘äººç„¡æ•¸ï¼ŒåŠŸå¾·ç„¡é‡ã€‚", historyNote: "è‘£å“å¼·è¿«ç™¾è¬äººå£è¥¿é·é•·å®‰ï¼Œæ²¿é€”æ­»å‚·ç„¡æ•¸ï¼Œæ´›é™½åŒ–ç‚ºç„¦åœŸã€‚" },
                    { text: "å†·çœ¼æ—è§€ï¼Œä¿å­˜å¯¦åŠ›", nextId: "ending_calc", effect: { wealth: 20 }, feedback: "ä½ ä¿å­˜äº†å¯¦åŠ›ï¼Œæº–å‚™åœ¨äº‚ä¸–ä¸­åˆ†ä¸€æ¯ç¾¹ã€‚", historyNote: "äº‚ä¸–ä¸­ï¼Œå¯¦åŠ›æ‰æ˜¯ç¡¬é“ç†ã€‚" }
                ]
            },

            // çµå±€è¨ˆç®—èˆ‡å±•ç¤º
            "ending_calc": { id: "ending_calc", title: "çµç®—ä¸­...", text: "æ­£åœ¨çµ±è¨ˆä½ çš„æ­·å²è©•åƒ¹...", isCalc: true, image: "Classroom" },
            
            // ä¹å¤§çµå±€
            "ending_emperor": { id: "ending_emperor", title: "çµå±€ï¼šåƒå¤ä¸€å¸", text: "ä½ çš„ç¶œåˆèƒ½åŠ›é”åˆ°äº†é ‚å³°ï¼ä½ åƒç§¦çš‡æ¼¢æ­¦ä¸€æ¨£ï¼Œåœ¨äº‚ä¸–ä¸­å»ºç«‹äº†è‡ªå·±çš„éœ¸æ¥­ï¼Œåå‚é’å²ã€‚", image: "QinPalace" },
            "ending_general": { id: "ending_general", title: "çµå±€ï¼šäº‚ä¸–åå°‡", text: "ä½ å‹‡å† ä¸‰è»ï¼Œè²åé æ’­ã€‚ä½ å°±åƒè¡›é’ã€éœå»ç—…ä¸€æ¨£ï¼Œæ˜¯åœ‹å®¶æœ€å …å¯¦çš„ç›¾ç‰Œã€‚", image: "War" },
            "ending_scholar": { id: "ending_scholar", title: "çµå±€ï¼šä¸€ä»£å®—å¸«", text: "ä½ åšå¤é€šä»Šï¼Œå­¸å¯Œäº”è»Šã€‚ä½ å‚³æ‰¿äº†æ–‡æ˜çš„ç«ç¨®ï¼Œåƒå¸é¦¬é·ã€è‘£ä»²èˆ’ä¸€æ¨£å½±éŸ¿äº†å¾Œä¸–ã€‚", image: "Study" },
            "ending_rich": { id: "ending_rich", title: "çµå±€ï¼šå¯Œç”²ä¸€æ–¹", text: "ä½ æŒæ¡äº†ç¶“æ¿Ÿå‘½è„ˆï¼Œå¯Œå¯æ•µåœ‹ã€‚åœ¨äº‚ä¸–ä¸­ï¼Œè²¡å¯Œä¹Ÿæ˜¯ä¸€ç¨®å¼·å¤§çš„åŠ›é‡ã€‚", image: "Treasury" },
            "ending_official": { id: "ending_official", title: "çµå±€ï¼šæ¬Šå‚¾æœé‡", text: "ä½ é•·è¢–å–„èˆï¼Œæ¬Šè¬€éäººã€‚é›–ç„¶åè²ä¸ä½³ï¼Œä½†ä½ æŒæ¡äº†å¯¦æ¬Šï¼Œæˆç‚ºäº†ä¸€ä»£æ¬Šè‡£ã€‚", image: "QinPalace" },
            "ending_doctor": { id: "ending_doctor", title: "çµå±€ï¼šæ‡¸å£ºæ¿Ÿä¸–", text: "ä½ ç²¾é€šé†«è¡“ï¼Œæ•‘æ­»æ‰¶å‚·ã€‚é›–ç„¶ä¸å•æ”¿æ²»ï¼Œä½†ç™¾å§“ç‚ºä½ ç«‹ç”Ÿç¥ ï¼Œç¨±ä½ ç‚ºé†«è–ã€‚", image: "Study" },
            "ending_exile": { id: "ending_exile", title: "çµå±€ï¼šæµäº¡æµ·å¤–", text: "ä½ å¸¶è‘—è²¡å¯Œé èµ°é«˜é£›ï¼Œé¿é–‹äº†ä¸­åŸçš„æˆ°äº‚ï¼Œåœ¨æµ·å¤–é–‹ææ•£è‘‰ã€‚", image: "Desert" },
            "ending_martyr": { id: "ending_martyr", title: "çµå±€ï¼šèµ·ç¾©çƒˆå£«", text: "ä½ ç‚ºäº†ç†æƒ³è€Œæˆ°ï¼Œé›–ç„¶å¤±æ•—èº«æ­»ï¼Œä½†ä½ çš„ç²¾ç¥æ¿€å‹µäº†å¾Œä¾†è€…ã€‚", image: "Fire" },
            "ending_commoner": { id: "ending_commoner", title: "çµå±€ï¼šæ­¸éš±ç”°åœ’", text: "ä½ å¹³å®‰åº¦éäº†æ³¢ç€¾å£¯é—Šçš„ç§¦æ¼¢å››ç™¾å¹´ï¼Œé¸æ“‡æ­¸éš±ç”°åœ’ã€‚é›–ç„¶å²æ›¸ç„¡åï¼Œä½†é€™ä¹Ÿæ˜¯ä¸€ç¨®å¹¸ç¦ã€‚", image: "Farm" },
            
            "game_over": { id: "game_over", title: "å£¯å¿—æœªé…¬", text: "å¾ˆéºæ†¾ï¼Œä½ çš„é«”åŠ›è€—ç›¡ï¼Œå€’åœ¨äº†æ­·å²çš„é•·æ²³ä¸­...", image: "Fire" }
        };

        // --- é¡¯ç¤ºçµ„ä»¶ ---
        const SceneDisplay = ({ imageName }) => {
            const [imgError, setImgError] = useState(false);
            const imageUrl = SceneImages[imageName] || SceneImages.Classroom;

            return (
                <div className="w-full h-56 md:h-64 mb-6 relative scene-image-container bg-[#1a1a1a]">
                    {!imgError ? (
                        <img 
                            src={imageUrl} 
                            alt="å ´æ™¯åœ–" 
                            className="w-full h-full object-cover transition-transform duration-500 hover:scale-105"
                            onError={() => setImgError(true)}
                        />
                    ) : (
                        <div className="w-full h-full flex items-center justify-center text-stone-500 bg-stone-900">
                            <div className="text-center">
                                <div className="text-4xl mb-2">ğŸ–¼ï¸</div>
                                <div>åœ–ç‰‡è¼‰å…¥ä¸­...</div>
                            </div>
                        </div>
                    )}
                    <div className="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent pointer-events-none"></div>
                </div>
            );
        };

        // --- å•ç­”å½ˆçª—çµ„ä»¶ ---
        const QuizModal = ({ quiz, onAnswer }) => {
            return (
                <div className="fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 modal-enter">
                    <div className="bg-[#2a2a2a] p-6 rounded border-4 border-purple-500 max-w-lg w-full text-center shadow-2xl relative">
                        <div className="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-purple-700 text-white px-4 py-1 rounded border-2 border-purple-400 shadow-lg">
                            æ­·å²åäººå ‚
                        </div>
                        <h3 className="text-2xl font-bold text-purple-300 mb-2 mt-4">{quiz.npc} <span className="text-sm text-stone-400">({quiz.role})</span></h3>
                        <p className="text-lg text-stone-200 mb-6 border-b border-stone-600 pb-4">{quiz.question}</p>
                        <div className="grid grid-cols-1 gap-3">
                            {quiz.options.map((opt, idx) => (
                                <button 
                                    key={idx}
                                    onClick={() => onAnswer(idx)}
                                    className="w-full py-3 bg-stone-700 hover:bg-purple-900 text-white border-2 border-stone-500 hover:border-purple-400 rounded transition-all"
                                >
                                    {opt}
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [currentSceneId, setCurrentSceneId] = useState('intro');
            const [stats, setStats] = useState({ health: 100, knowledge: 10, wealth: 20, reputation: 0 });
            const [feedback, setFeedback] = useState(null);
            const [floatStats, setFloatStats] = useState([]);
            const [selectedOption, setSelectedOption] = useState(null);
            const [nextSceneId, setNextSceneId] = useState(null);
            const [shake, setShake] = useState(false);
            const [quizEvent, setQuizEvent] = useState(null);
            // è¿½è¹¤å·²é‡éçš„åäºº
            const [seenEventIndices, setSeenEventIndices] = useState(new Set());

            const currentScene = storyNodes[currentSceneId] || storyNodes['intro'];

            // è§¸ç™¼éœ‡å‹•
            const triggerShake = () => {
                setShake(true);
                setTimeout(() => setShake(false), 500);
            };

            // é¡¯ç¤ºåé¥‹
            const showFeedback = (msg, type) => {
                setFeedback({ msg, type });
                setTimeout(() => setFeedback(null), 3000); // 3ç§’é–±è®€æ™‚é–“
            };

            // éš¨æ©Ÿäº‹ä»¶æª¢æŸ¥ (æ¯é—œé–‹å§‹å‰)
            useEffect(() => {
                // åªæœ‰åœ¨éçµå±€ã€éåºç« ã€ééŠæˆ²çµæŸä¸”ç•¶å‰æ²’æœ‰äº‹ä»¶æ™‚æ‰è§¸ç™¼
                if (!currentSceneId.startsWith('ending') && currentSceneId !== 'intro' && currentSceneId !== 'game_over' && !quizEvent) {
                    // 20% æ©Ÿç‡è§¸ç™¼ (èª¿æ•´å¾Œ)
                    if (Math.random() < 0.20) {
                        // éæ¿¾å‡ºå°šæœªé‡éçš„åäºº
                        const availableIndices = historyQuizPool.map((_, i) => i).filter(i => !seenEventIndices.has(i));
                        
                        // å¦‚æœé‚„æœ‰æ²’é‡éçš„åäºº
                        if (availableIndices.length > 0) {
                            const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
                            const randomQuiz = historyQuizPool[randomIndex];
                            
                            setQuizEvent(randomQuiz);
                            // å°‡æ­¤ç´¢å¼•åŠ å…¥å·²é‡éé›†åˆ
                            setSeenEventIndices(prev => new Set(prev).add(randomIndex));
                        }
                    }
                }
            }, [currentSceneId]);

            // è™•ç†å•ç­”
            const handleQuizAnswer = (answerIndex) => {
                const isCorrect = answerIndex === quizEvent.answer;
                let newStats = { ...stats };
                let changes = [];

                if (isCorrect) {
                    if (quizEvent.reward.knowledge) { newStats.knowledge += quizEvent.reward.knowledge; changes.push({label:'æ™ºåŠ›', val:quizEvent.reward.knowledge, color:'text-blue-400'}); }
                    if (quizEvent.reward.prestige) { newStats.reputation += quizEvent.reward.prestige; changes.push({label:'è²æœ›', val:quizEvent.reward.prestige, color:'text-purple-400'}); }
                    if (quizEvent.reward.health) { newStats.health += quizEvent.reward.health; changes.push({label:'é«”åŠ›', val:quizEvent.reward.health, color:'text-red-400'}); }
                    if (quizEvent.reward.wealth) { newStats.wealth += quizEvent.reward.wealth; changes.push({label:'è²¡å¯Œ', val:quizEvent.reward.wealth, color:'text-yellow-400'}); }
                    if (quizEvent.reward.reputation) { newStats.reputation += quizEvent.reward.reputation; changes.push({label:'è²æœ›', val:quizEvent.reward.reputation, color:'text-purple-400'}); }
                    showFeedback(`[âœ” æ­£ç¢º] ${quizEvent.correctMsg}`, 'story');
                } else {
                    if (quizEvent.penalty.knowledge) { newStats.knowledge += quizEvent.penalty.knowledge; changes.push({label:'æ™ºåŠ›', val:quizEvent.penalty.knowledge, color:'text-stone-400'}); }
                    if (quizEvent.penalty.prestige) { newStats.reputation += quizEvent.penalty.prestige; changes.push({label:'è²æœ›', val:quizEvent.penalty.prestige, color:'text-stone-400'}); }
                    if (quizEvent.penalty.health) { newStats.health += quizEvent.penalty.health; changes.push({label:'é«”åŠ›', val:quizEvent.penalty.health, color:'text-stone-400'}); }
                    if (quizEvent.penalty.wealth) { newStats.wealth += quizEvent.penalty.wealth; changes.push({label:'è²¡å¯Œ', val:quizEvent.penalty.wealth, color:'text-stone-400'}); }
                    if (quizEvent.penalty.reputation) { newStats.reputation += quizEvent.penalty.reputation; changes.push({label:'è²æœ›', val:quizEvent.penalty.reputation, color:'text-stone-400'}); }
                    showFeedback(`[âŒ éŒ¯èª¤] ${quizEvent.wrongMsg}`, 'error');
                    triggerShake();
                }

                setStats(newStats);
                setFloatStats(changes);
                setQuizEvent(null); // é—œé–‰å½ˆçª—
            };

            // è™•ç†çµå±€è¨ˆç®—
            useEffect(() => {
                if (currentScene?.isCalc) {
                    let nextId = 'ending_commoner';
                    if (stats.health <= 0) {
                         nextId = 'game_over';
                    } else {
                        const { health, knowledge, wealth, reputation } = stats;
                        // æ“´å……çµå±€åˆ¤æ–·é‚è¼¯
                        if (reputation >= 100 && wealth >= 80 && knowledge >= 60) nextId = 'ending_emperor';
                        else if (wealth >= 80 && knowledge >= 80 && reputation < 40) nextId = 'ending_official'; // æ¬Šè‡£
                        else if (reputation >= 80 && health >= 60) nextId = 'ending_general';
                        else if (knowledge >= 100 && health >= 60) nextId = 'ending_doctor'; // é†«è–
                        else if (knowledge >= 100) nextId = 'ending_scholar';
                        else if (wealth >= 120 && reputation < 50) nextId = 'ending_exile'; // æµäº¡å¯Œè±ª
                        else if (wealth >= 100) nextId = 'ending_rich';
                        else if (reputation >= 60 && health <= 30) nextId = 'ending_martyr'; // çƒˆå£«
                        else nextId = 'ending_commoner';
                    }
                    setTimeout(() => setCurrentSceneId(nextId), 2000);
                }
            }, [currentSceneId, stats]);

            // è™•ç†é¸é …é»æ“Š
            const handleChoice = (option, index) => {
                // æ¢ä»¶æª¢æŸ¥
                if (option.reqKnowledge && stats.knowledge < option.reqKnowledge) { triggerShake(); showFeedback(`[âŒ æ™ºåŠ›ä¸è¶³] éœ€ ${option.reqKnowledge}`, 'error'); return; }
                if (option.reqHealth && stats.health < option.reqHealth) { triggerShake(); showFeedback(`[âŒ é«”åŠ›ä¸è¶³] éœ€ ${option.reqHealth}`, 'error'); return; }
                if (option.reqWealth && stats.wealth < option.reqWealth) { triggerShake(); showFeedback(`[âŒ è²¡å¯Œä¸è¶³] éœ€ ${option.reqWealth}`, 'error'); return; }
                if (option.reqReputation && stats.reputation < option.reqReputation) { triggerShake(); showFeedback(`[âŒ è²æœ›ä¸è¶³] éœ€ ${option.reqReputation}`, 'error'); return; }

                setSelectedOption(index);
                
                // æ•¸å€¼è®ŠåŒ–èˆ‡å‹•ç•«
                let newStats = { ...stats };
                let changes = [];
                const effect = option.effect || {};
                
                if (effect.health) { newStats.health += effect.health; changes.push({label:'é«”åŠ›', val:effect.health, color: effect.health>0?'text-red-400':'text-stone-400'}); }
                if (effect.knowledge) { newStats.knowledge += effect.knowledge; changes.push({label:'æ™ºåŠ›', val:effect.knowledge, color: 'text-blue-400'}); }
                if (effect.wealth) { newStats.wealth += effect.wealth; changes.push({label:'è²¡å¯Œ', val:effect.wealth, color: 'text-yellow-400'}); }
                if (effect.reputation) { newStats.reputation += effect.reputation; changes.push({label:'è²æœ›', val:effect.reputation, color: 'text-purple-400'}); }

                if (newStats.health < 0) newStats.health = 0;
                setStats(newStats);
                setFloatStats(changes);

                if (option.feedback) showFeedback(`[âœ”] ${option.feedback}`, 'story');
                
                if (newStats.health <= 0) setNextSceneId('game_over');
                else setNextSceneId(option.nextId);
            };

            // ä¸‹ä¸€æ­¥
            const handleNext = () => {
                setCurrentSceneId(nextSceneId);
                setSelectedOption(null);
                setNextSceneId(null);
                setFloatStats([]);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // é‡ç½®
            const resetGame = () => {
                setCurrentSceneId('intro');
                setStats({ health: 100, knowledge: 10, wealth: 20, reputation: 0 });
                setSelectedOption(null);
                setNextSceneId(null);
                setFloatStats([]);
                setQuizEvent(null);
                setSeenEventIndices(new Set());
            };

            const isEnding = currentScene.id.startsWith('ending') || currentScene.id === 'game_over';

            return (
                <div className="min-h-screen flex items-center justify-center py-6 px-4">
                    <div className={`max-w-2xl w-full scroll-container rounded-lg relative ${shake ? 'shake' : ''}`}>
                        
                        {/* ç‹€æ…‹æ¬„ HUD (å››è‰²å€åˆ†) */}
                        <div className="bg-[#222] text-amber-100 p-4 border-b-4 border-[#8b7355] sticky top-0 z-30 shadow-lg">
                            <div className="flex justify-between items-center mb-3">
                                <h1 className="text-3xl font-bold tracking-widest text-yellow-300">ç§¦æ¼¢é¢¨é›²</h1>
                                <div className="text-sm text-stone-300 font-mono">é—œå¡ {currentScene.title.split('.')[0]}</div>
                            </div>
                            <div className="grid grid-cols-4 gap-2">
                                <div className="bg-red-900/80 p-2 rounded border-2 border-red-600 flex flex-col items-center shadow-inner">
                                    <div className="text-xs text-red-200 mb-1 flex items-center gap-1"><Icons.Heart/> é«”åŠ›</div>
                                    <span className="font-bold text-lg text-white">{stats.health}</span>
                                </div>
                                <div className="bg-blue-900/80 p-2 rounded border-2 border-blue-600 flex flex-col items-center shadow-inner">
                                    <div className="text-xs text-blue-200 mb-1 flex items-center gap-1"><Icons.Brain/> æ™ºåŠ›</div>
                                    <span className="font-bold text-lg text-white">{stats.knowledge}</span>
                                </div>
                                <div className="bg-yellow-700/80 p-2 rounded border-2 border-yellow-500 flex flex-col items-center shadow-inner">
                                    <div className="text-xs text-yellow-100 mb-1 flex items-center gap-1"><Icons.Coin/> è²¡å¯Œ</div>
                                    <span className="font-bold text-lg text-white">{stats.wealth}</span>
                                </div>
                                <div className="bg-purple-900/80 p-2 rounded border-2 border-purple-600 flex flex-col items-center shadow-inner">
                                    <div className="text-xs text-purple-200 mb-1 flex items-center gap-1"><Icons.Star/> è²æœ›</div>
                                    <span className="font-bold text-lg text-white">{stats.reputation}</span>
                                </div>
                            </div>
                        </div>

                        {/* ä¸»è¦å…§å®¹å€ */}
                        <div className="p-6 relative min-h-[500px]">
                            
                            {/* å•ç­”å½ˆçª— */}
                            {quizEvent && <QuizModal quiz={quizEvent} onAnswer={handleQuizAnswer} />}

                            {/* æµ®å‹•æ•¸å€¼ */}
                            <div className="absolute top-4 right-4 z-40 flex flex-col items-end pointer-events-none">
                                {floatStats.map((item, idx) => (
                                    <div key={idx} className={`stat-float ${item.color}`} style={{animationDelay: `${idx * 0.1}s`}}>
                                        {item.label} {item.val > 0 ? '+' : ''}{item.val}
                                    </div>
                                ))}
                            </div>

                            {/* æç¤ºè¨Šæ¯ (ç½®ä¸­) */}
                            {feedback && (
                                <div className="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 px-8 py-5 bg-stone-800 text-amber-100 border-4 border-amber-500 shadow-2xl text-center font-bold rounded-lg animate-bounce text-lg">
                                    {feedback.msg}
                                </div>
                            )}

                            {/* æ¨™é¡Œ */}
                            <h2 className="text-3xl font-bold text-center mb-6 text-amber-200 border-b-2 border-stone-600 pb-3">{currentScene.title}</h2>
                            
                            {/* å ´æ™¯åœ– */}
                            {!currentScene.isCalc && <SceneDisplay imageName={currentScene.image} />}

                            {/* æ•…äº‹æ–‡æœ¬ */}
                            <div className="text-lg text-stone-300 leading-relaxed mb-8 p-4 bg-[#2a2a2a] border border-stone-600 rounded-lg shadow-inner tracking-wide">
                                {currentScene.text}
                            </div>

                            {/* é¸é …å€åŸŸ */}
                            <div className="grid gap-5">
                                {!isEnding ? (
                                    currentScene.options.map((opt, idx) => (
                                        <div 
                                            key={idx}
                                            onClick={() => !nextSceneId && handleChoice(opt, idx)}
                                            className={`relative p-5 rounded transition-all game-btn ${
                                                selectedOption === idx 
                                                    ? 'selected' 
                                                    : nextSceneId !== null 
                                                        ? 'opacity-40 cursor-default grayscale' 
                                                        : 'hover:border-yellow-300'
                                            } ${nextSceneId && selectedOption !== idx ? 'pointer-events-none' : ''}`}
                                        >
                                            <div className="flex justify-between items-center font-bold text-lg mb-1">
                                                <span>{opt.text}</span>
                                                {selectedOption === idx && <span className="text-yellow-300 text-sm animate-pulse">â—„ å·²é¸</span>}
                                            </div>
                                            
                                            {/* æ¢ä»¶æç¤º (æœªé¸æ“‡æ™‚é¡¯ç¤º) */}
                                            {!nextSceneId && (
                                                <div className="text-xs text-stone-400 flex flex-wrap gap-x-4 mt-2 font-mono">
                                                    {opt.reqKnowledge && <span className="text-blue-400">ğŸ§  éœ€æ™ºåŠ› {opt.reqKnowledge}</span>}
                                                    {opt.reqHealth && <span className="text-red-400">â¤ éœ€é«”åŠ› {opt.reqHealth}</span>}
                                                    {opt.reqWealth && <span className="text-yellow-400">ğŸ’° éœ€è²¡å¯Œ {opt.reqWealth}</span>}
                                                    {opt.reqReputation && <span className="text-purple-400">ğŸ‘‘ éœ€è²æœ› {opt.reqReputation}</span>}
                                                </div>
                                            )}

                                            {/* é¸æ“‡å¾Œå±•é–‹ï¼šæ•¸å€¼è®ŠåŒ–èˆ‡å²å¯¦å°è¬›å ‚ */}
                                            {selectedOption === idx && nextSceneId !== null && (
                                                <div className="mt-4 pt-4 border-t-2 border-stone-500/50 animate-in fade-in slide-in-from-top-2 duration-300">
                                                    {/* æ•¸å€¼çµæœ */}
                                                    <div className="flex flex-wrap gap-4 font-bold mb-4 text-sm bg-black/20 p-2 rounded">
                                                        {opt.effect?.health !== 0 && <span className={opt.effect.health>0?'text-red-400':'text-stone-400'}>é«”åŠ›{opt.effect.health>0?'+':''}{opt.effect.health}</span>}
                                                        {opt.effect?.wealth !== 0 && <span className="text-yellow-400">è²¡å¯Œ{opt.effect.wealth>0?'+':''}{opt.effect.wealth}</span>}
                                                        {opt.effect?.reputation !== 0 && <span className="text-purple-400">è²æœ›{opt.effect.reputation>0?'+':''}{opt.effect.reputation}</span>}
                                                        {opt.effect?.knowledge !== 0 && <span className="text-blue-400">æ™ºåŠ›{opt.effect.knowledge>0?'+':''}{opt.effect.knowledge}</span>}
                                                    </div>
                                                    
                                                    {/* æ­·å²å°è¬›å ‚ (é»ƒè‰²å·è»¸é¢¨æ ¼) */}
                                                    {opt.historyNote && (
                                                        <div className="bg-[#3d362a] p-4 rounded text-base text-amber-100 border-l-4 border-amber-500 mb-5 shadow-md">
                                                            <strong className="block text-amber-400 mb-2 text-lg border-b border-amber-700/50 pb-1">ğŸ“œ æ­·å²å°è¬›å ‚</strong>
                                                            {opt.historyNote}
                                                        </div>
                                                    )}
                                                    
                                                    {/* ä¸‹ä¸€æ­¥æŒ‰éˆ• */}
                                                    <button 
                                                        onClick={(e) => { e.stopPropagation(); handleNext(); }}
                                                        className="w-full bg-green-700 text-white py-3 font-bold rounded hover:bg-green-600 flex items-center justify-center gap-2 shadow-xl border-2 border-green-500 transition-transform active:scale-95"
                                                    >
                                                        å‰å¾€ä¸‹ä¸€é—œ <Icons.ArrowRight/>
                                                    </button>
                                                </div>
                                            )}
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center p-8 bg-[#2a2a2a] rounded-lg border-2 border-stone-600">
                                        <h3 className="text-3xl text-yellow-300 font-bold mb-4 border-b border-stone-500 pb-4">â€” æ­·å²çš„çµ‚ç«  â€”</h3>
                                        <div className="text-xl text-stone-200 mb-8 leading-relaxed">{currentScene.text}</div>
                                        <button onClick={resetGame} className="w-full bg-red-700 text-white py-4 font-bold text-xl rounded hover:bg-red-600 flex items-center justify-center gap-2 shadow-xl border-2 border-red-500 transition-transform active:scale-95">
                                            <Icons.Refresh/> é‡å•Ÿæ™‚å…‰ä¹‹æ—…
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                        
                        <div className="bg-[#1A192A] text-[#5C5B7F] text-center py-2 text-xs font-mono border-t-4 border-[#5C5B7F]">
                            æ™‚å…‰è¡Œè€… RPG - ç§¦æ¼¢é¢¨é›² (2024)
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
